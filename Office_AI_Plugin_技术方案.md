# Office AI æ’ä»¶æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-12  
> **åŸºäº**: ç°æœ‰ Office MCP Server é¡¹ç›®  
> **ç›®æ ‡**: è®¾è®¡ä¸€ä¸ªOfficeæ’ä»¶,å®ç°AIå¯¹è¯é©±åŠ¨çš„æ–‡æ¡£æ“ä½œ

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç°æœ‰MCPæœåŠ¡åˆ†æ](#ç°æœ‰mcpæœåŠ¡åˆ†æ)
3. [æŠ€æœ¯æ¶æ„è®¾è®¡](#æŠ€æœ¯æ¶æ„è®¾è®¡)
4. [åŒå‘é€šä¿¡æœºåˆ¶](#åŒå‘é€šä¿¡æœºåˆ¶)
5. [AIå¯¹è¯é›†æˆ](#aiå¯¹è¯é›†æˆ)
6. [å¯è¡Œæ€§åˆ†æ](#å¯è¡Œæ€§åˆ†æ)
7. [å¼€å‘ç»„ä»¶æ¸…å•](#å¼€å‘ç»„ä»¶æ¸…å•)
8. [å®æ–½æ­¥éª¤](#å®æ–½æ­¥éª¤)
9. [æŠ€æœ¯é€‰å‹](#æŠ€æœ¯é€‰å‹)

---

## é¡¹ç›®æ¦‚è¿°

### éœ€æ±‚ç›®æ ‡

è®¾è®¡ä¸€ä¸ªOfficeæ’ä»¶,å®ç°ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½:

1. **åŒå‘é€šä¿¡**: Officeæ’ä»¶èƒ½å¤Ÿè°ƒç”¨ç°æœ‰çš„MCPæœåŠ¡,åŒæ—¶MCPæœåŠ¡èƒ½å¤Ÿè¯»å–å½“å‰æ‰“å¼€çš„Officeæ–‡æ¡£å†…å®¹
2. **AIå¯¹è¯ç•Œé¢**: ç”¨æˆ·åœ¨Officeæ’ä»¶ä¸­è¿›è¡ŒAIå¯¹è¯
3. **å®æ—¶æ“ä½œ**: AIå¯¹è¯èƒ½å¤Ÿè°ƒç”¨MCPæœåŠ¡å¯¹Officeæ–‡æ¡£è¿›è¡Œæ“ä½œ(å¦‚ç¼–è¾‘Wordã€ä¿®æ”¹Excelç­‰)
4. **å¯è§†åŒ–åé¦ˆ**: ç”¨æˆ·èƒ½å¤Ÿåœ¨Officeç•Œé¢ä¸­å®æ—¶çœ‹åˆ°æ–‡æ¡£çš„è°ƒæ•´å’Œå˜åŒ–

### è®¾è®¡åŸåˆ™

- âœ… **å¤ç”¨ç°æœ‰**: æœ€å¤§åŒ–åˆ©ç”¨ç°æœ‰MCPæœåŠ¡,é¿å…é‡å¤å¼€å‘
- âœ… **è§£è€¦è®¾è®¡**: æ’ä»¶ã€ä¸­é—´å±‚ã€MCPæœåŠ¡ä¸‰å±‚è§£è€¦
- âœ… **è·¨å¹³å°**: æ”¯æŒWindowsã€Macã€Webç‰ˆOffice
- âœ… **ç”¨æˆ·ä½“éªŒ**: å®æ—¶åé¦ˆ,æ“ä½œæµç•…
- âœ… **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œæ–°çš„Officeåº”ç”¨æ”¯æŒ

---

## ç°æœ‰MCPæœåŠ¡åˆ†æ

### æŠ€æœ¯æ ˆ

åŸºäºä»£ç åˆ†æ,å½“å‰MCPæœåŠ¡ä½¿ç”¨:

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| **è¿è¡Œç¯å¢ƒ** | Python | 3.10+ | æ¨è 3.11/3.12 |
| **MCPæ¡†æ¶** | FastMCP | æœ€æ–°ç‰ˆ | ç®€åŒ–MCPå¼€å‘ |
| **Wordå¤„ç†** | python-docx | 1.1.0+ | âœ… æ”¯æŒè¯»å†™ |
| **Excelå¤„ç†** | openpyxl | 3.1.0+ | âœ… æ”¯æŒè¯»å†™ |
| **PPTå¤„ç†** | python-pptx | 0.6.23+ | âœ… æ”¯æŒè¯»å†™ |
| **æ—¥å¿—** | loguru | 0.7.0+ | ç»“æ„åŒ–æ—¥å¿— |
| **é…ç½®** | pydantic | 2.0+ | é…ç½®ç®¡ç† |

### æœåŠ¡æ¶æ„

```
src/office_mcp_server/
â”œâ”€â”€ main.py                 # MCPæœåŠ¡å™¨å…¥å£
â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”œâ”€â”€ handlers/               # ä¸šåŠ¡å¤„ç†å±‚
â”‚   â”œâ”€â”€ word_handler.py     # Wordå¤„ç†å™¨(é—¨é¢æ¨¡å¼)
â”‚   â”œâ”€â”€ excel_handler.py    # Excelå¤„ç†å™¨
â”‚   â””â”€â”€ ppt_handler.py      # PowerPointå¤„ç†å™¨
â”œâ”€â”€ tools/                  # MCPå·¥å…·å®šä¹‰å±‚
â”‚   â”œâ”€â”€ word/               # Wordå·¥å…·(59ä¸ª)
â”‚   â”œâ”€â”€ excel/              # Excelå·¥å…·(91ä¸ª)
â”‚   â””â”€â”€ ppt/                # PowerPointå·¥å…·(34ä¸ª)
â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
    â”œâ”€â”€ file_manager.py     # æ–‡ä»¶ç®¡ç†
    â””â”€â”€ format_helper.py    # æ ¼å¼åŒ–è¾…åŠ©
```

### é€šä¿¡åè®®

- **åè®®**: MCP (Model Context Protocol)
- **ä¼ è¾“æ–¹å¼**: stdio (æ ‡å‡†è¾“å…¥è¾“å‡º)
- **æ•°æ®æ ¼å¼**: JSON
- **å·¥å…·æ³¨å†Œ**: ä½¿ç”¨ `@mcp.tool()` è£…é¥°å™¨
- **å¯åŠ¨æ–¹å¼**: å‘½ä»¤è¡Œå¯åŠ¨ `python src/office_mcp_server/main.py`

### åŠŸèƒ½ç»Ÿè®¡

| Officeåº”ç”¨ | å·¥å…·æ•°é‡ | æ ¸å¿ƒåŠŸèƒ½ |
|-----------|---------|---------|
| **Word** | 59ä¸ª | æ–‡æ¡£åˆ›å»ºã€ç¼–è¾‘ã€æ ¼å¼åŒ–ã€è¡¨æ ¼ã€å›¾ç‰‡ã€æ‰¹é‡æ“ä½œ |
| **Excel** | 91ä¸ª | å·¥ä½œç°¿ç®¡ç†ã€æ•°æ®æ“ä½œã€å…¬å¼ã€å›¾è¡¨ã€åˆ†æã€å®‰å…¨ |
| **PowerPoint** | 34ä¸ª | æ¼”ç¤ºåˆ›å»ºã€å¹»ç¯ç‰‡ç®¡ç†ã€å†…å®¹ç¼–è¾‘ã€æ ·å¼ã€å¯¼å‡º |
| **æ€»è®¡** | **184ä¸ª** | è¦†ç›–Officeä¸‰å¤§åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ |

### æ–‡ä»¶æ“ä½œæœºåˆ¶

- **å·¥ä½œç›®å½•**: æ‰€æœ‰æ–‡ä»¶æ“ä½œåœ¨ `output/` ç›®å½•ä¸‹
- **æ–‡ä»¶ç®¡ç†**: ä½¿ç”¨ `FileManager` ç±»ç»Ÿä¸€ç®¡ç†
- **è·¯å¾„å¤„ç†**: æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„
- **æ–‡ä»¶éªŒè¯**: è‡ªåŠ¨éªŒè¯æ–‡ä»¶æ‰©å±•åå’Œå­˜åœ¨æ€§

### å…³é”®å‘ç°

1. âœ… **MCPæœåŠ¡æ˜¯ç‹¬ç«‹è¿›ç¨‹**: é€šè¿‡stdioä¸å¤–éƒ¨é€šä¿¡,æ— æ³•ç›´æ¥è®¿é—®Officeåº”ç”¨å†…å­˜
2. âœ… **åŸºäºæ–‡ä»¶æ“ä½œ**: æ‰€æœ‰æ“ä½œéƒ½æ˜¯è¯»å†™æ–‡ä»¶,ä¸æ˜¯æ“ä½œOfficeåº”ç”¨å¯¹è±¡
3. âœ… **åŒæ­¥è°ƒç”¨**: å·¥å…·è°ƒç”¨æ˜¯åŒæ­¥çš„,è¿”å›JSONæ ¼å¼ç»“æœ
4. âš ï¸ **æ— æ³•ç›´æ¥è¯»å–å½“å‰æ–‡æ¡£**: MCPæœåŠ¡åªèƒ½æ“ä½œç£ç›˜æ–‡ä»¶,æ— æ³•è®¿é—®Officeä¸­æ‰“å¼€çš„æ–‡æ¡£

---

## æŠ€æœ¯æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

é‡‡ç”¨**ä¸‰å±‚æ¶æ„**è®¾è®¡,å®ç°æ’ä»¶ä¸MCPæœåŠ¡çš„è§£è€¦:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Office åº”ç”¨å±‚                             â”‚
â”‚              (Word / Excel / PowerPoint)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Office Add-in (æ’ä»¶å‰ç«¯)                     â”‚  â”‚
â”‚  â”‚  - AIå¯¹è¯ç•Œé¢ (React + TypeScript)                   â”‚  â”‚
â”‚  â”‚  - æ–‡æ¡£æ“ä½œé¢æ¿                                       â”‚  â”‚
â”‚  â”‚  - Office.js API é›†æˆ                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ HTTP/WebSocket
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Bridge Server (ä¸­é—´å±‚)                          â”‚
â”‚  - HTTP API æœåŠ¡å™¨ (Node.js/FastAPI)                        â”‚
â”‚  - MCP å®¢æˆ·ç«¯ (stdio é€šä¿¡)                                  â”‚
â”‚  - æ–‡ä»¶ç®¡ç†æœåŠ¡                                              â”‚
â”‚  - LLM API é›†æˆ (OpenAI/Claude)                             â”‚
â”‚  - WebSocket æœåŠ¡ (å®æ—¶é€šä¿¡)                                â”‚
â”‚  - ä¼šè¯ç®¡ç†                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ stdio (JSON-RPC)
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Office MCP Server (ç°æœ‰æœåŠ¡)                       â”‚
â”‚  - Word Handler (59ä¸ªå·¥å…·)                                  â”‚
â”‚  - Excel Handler (91ä¸ªå·¥å…·)                                 â”‚
â”‚  - PowerPoint Handler (34ä¸ªå·¥å…·)                            â”‚
â”‚  - æ–‡ä»¶æ“ä½œ (output/ ç›®å½•)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### 1. Office Add-in (æ’ä»¶å‰ç«¯)

**æŠ€æœ¯æ ˆ**: React + TypeScript + Office.js

**ä¸»è¦åŠŸèƒ½**:
- æä¾›AIå¯¹è¯ç•Œé¢
- é€šè¿‡Office.js APIè¯»å–/å†™å…¥æ–‡æ¡£
- å‘é€HTTPè¯·æ±‚åˆ°Bridge Server
- å®æ—¶æ˜¾ç¤ºæ“ä½œç»“æœ

**å…³é”®API**:
```typescript
// è¯»å–æ–‡æ¡£å†…å®¹
Office.context.document.getFileAsync(
  Office.FileType.Compressed,
  { sliceSize: 65536 },
  (result) => { /* å¤„ç†æ–‡æ¡£æ•°æ® */ }
);

// æ›´æ–°æ–‡æ¡£å†…å®¹
Office.context.document.setSelectedDataAsync(
  data,
  { coercionType: Office.CoercionType.Text },
  (result) => { /* å¤„ç†ç»“æœ */ }
);
```

#### 2. Bridge Server (ä¸­é—´å±‚)

**æŠ€æœ¯æ ˆ**: Node.js + Express + TypeScript (æ¨è) æˆ– Python + FastAPI

**ä¸»è¦åŠŸèƒ½**:
- æ¥æ”¶æ’ä»¶çš„HTTPè¯·æ±‚
- ç®¡ç†ä¸´æ—¶æ–‡ä»¶(ä¿å­˜æ’ä»¶å‘é€çš„æ–‡æ¡£)
- é€šè¿‡stdioè°ƒç”¨MCPæœåŠ¡
- é›†æˆLLM APIè¿›è¡Œæ„å›¾è¯†åˆ«
- é€šè¿‡WebSocketæ¨é€å®æ—¶è¿›åº¦

**æ ¸å¿ƒæ¥å£**:
```typescript
// API ç«¯ç‚¹è®¾è®¡
POST /api/chat          // AIå¯¹è¯æ¥å£
POST /api/execute       // ç›´æ¥æ‰§è¡ŒMCPå·¥å…·
POST /api/document/sync // åŒæ­¥æ–‡æ¡£åˆ°ä¸´æ—¶æ–‡ä»¶
GET  /api/document/:id  // è·å–å¤„ç†åçš„æ–‡æ¡£
WS   /ws/session/:id    // WebSocketå®æ—¶é€šä¿¡
```

#### 3. MCP Client Library (MCPå®¢æˆ·ç«¯åº“)

**æŠ€æœ¯æ ˆ**: TypeScript/Python

**ä¸»è¦åŠŸèƒ½**:
- å°è£…stdioé€šä¿¡é€»è¾‘
- æä¾›å·¥å…·è°ƒç”¨æ¥å£
- å¤„ç†JSON-RPCåè®®
- é”™è¯¯å¤„ç†å’Œé‡è¯•

**ç¤ºä¾‹ä»£ç **:
```typescript
class MCPClient {
  async callTool(toolName: string, args: any): Promise<any> {
    // é€šè¿‡stdioå‘é€JSON-RPCè¯·æ±‚
    const request = {
      jsonrpc: "2.0",
      method: "tools/call",
      params: { name: toolName, arguments: args },
      id: generateId()
    };

    // å‘é€åˆ°MCPæœåŠ¡çš„stdin
    this.process.stdin.write(JSON.stringify(request) + '\n');

    // ç­‰å¾…ä»stdoutè¯»å–å“åº”
    return await this.waitForResponse(request.id);
  }
}
```

---

## åŒå‘é€šä¿¡æœºåˆ¶

### é—®é¢˜åˆ†æ

**æ ¸å¿ƒæŒ‘æˆ˜**: MCPæœåŠ¡æ˜¯ç‹¬ç«‹è¿›ç¨‹,åªèƒ½æ“ä½œç£ç›˜æ–‡ä»¶,æ— æ³•ç›´æ¥è®¿é—®Officeåº”ç”¨ä¸­æ‰“å¼€çš„æ–‡æ¡£ã€‚

### è§£å†³æ–¹æ¡ˆ: æ–‡æ¡£åŒæ­¥æœºåˆ¶

é‡‡ç”¨**ä¸´æ—¶æ–‡ä»¶ä¸­è½¬**çš„æ–¹å¼å®ç°åŒå‘é€šä¿¡:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤1: ç”¨æˆ·åœ¨Officeä¸­æ‰“å¼€æ–‡æ¡£ (example.docx)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤2: ç”¨æˆ·åœ¨æ’ä»¶ä¸­è¾“å…¥AIæŒ‡ä»¤                               â”‚
â”‚  "è¯·å°†ç¬¬ä¸€æ®µæ–‡å­—åŠ ç²—å¹¶æ”¹ä¸ºçº¢è‰²"                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤3: æ’ä»¶é€šè¿‡Office.jsè¯»å–å½“å‰æ–‡æ¡£å†…å®¹                    â”‚
â”‚  const docData = await getDocumentData();                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤4: æ’ä»¶å‘é€HTTPè¯·æ±‚åˆ°Bridge Server                      â”‚
â”‚  POST /api/chat                                             â”‚
â”‚  { sessionId, userMessage, documentData }                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤5: Bridge Serverä¿å­˜æ–‡æ¡£åˆ°ä¸´æ—¶æ–‡ä»¶                      â”‚
â”‚  /tmp/sessions/{sessionId}/current.docx                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤6: Bridge Serverè°ƒç”¨LLMåˆ†æç”¨æˆ·æ„å›¾                     â”‚
â”‚  LLMè¿”å›: éœ€è¦è°ƒç”¨ format_word_text å·¥å…·                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤7: Bridge Serveré€šè¿‡stdioè°ƒç”¨MCPæœåŠ¡                    â”‚
â”‚  format_word_text(                                          â”‚
â”‚    filename="current.docx",                                 â”‚
â”‚    paragraph_index=0,                                       â”‚
â”‚    bold=True,                                               â”‚
â”‚    color="#FF0000"                                          â”‚
â”‚  )                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤8: MCPæœåŠ¡å¤„ç†æ–‡æ¡£å¹¶ä¿å­˜ç»“æœ                            â”‚
â”‚  è¿”å›: { success: true, filename: "current.docx" }          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤9: Bridge Serverè¯»å–å¤„ç†åçš„æ–‡æ¡£                        â”‚
â”‚  const resultData = readFile("current.docx");               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤10: Bridge Serverè¿”å›ç»“æœç»™æ’ä»¶                         â”‚
â”‚  { success: true, documentData: resultData }                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤11: æ’ä»¶é€šè¿‡Office.jsæ›´æ–°æ–‡æ¡£å†…å®¹                       â”‚
â”‚  await updateDocument(resultData);                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤12: ç”¨æˆ·åœ¨Officeä¸­çœ‹åˆ°å®æ—¶å˜åŒ–                          â”‚
â”‚  ç¬¬ä¸€æ®µæ–‡å­—å·²åŠ ç²—å¹¶å˜ä¸ºçº¢è‰² âœ…                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–‡æ¡£åŒæ­¥ç­–ç•¥

#### å®Œæ•´åŒæ­¥ vs å¢é‡åŒæ­¥

| ç­–ç•¥ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **å®Œæ•´åŒæ­¥** | å®ç°ç®€å•,æ•°æ®ä¸€è‡´æ€§å¥½ | å¤§æ–‡æ¡£æ€§èƒ½å·® | å°æ–‡æ¡£(<5MB) |
| **å¢é‡åŒæ­¥** | æ€§èƒ½å¥½,ç½‘ç»œä¼ è¾“å°‘ | å®ç°å¤æ‚,éœ€è¦diffç®—æ³• | å¤§æ–‡æ¡£(>5MB) |

**æ¨èæ–¹æ¡ˆ**:
- åˆæœŸä½¿ç”¨å®Œæ•´åŒæ­¥,å¿«é€ŸéªŒè¯
- åæœŸä¼˜åŒ–ä¸ºå¢é‡åŒæ­¥

#### ä¼šè¯ç®¡ç†

æ¯ä¸ªç”¨æˆ·ä¼šè¯ç»´æŠ¤ç‹¬ç«‹çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•:

```
/tmp/office-ai-sessions/
â”œâ”€â”€ session-abc123/
â”‚   â”œâ”€â”€ current.docx        # å½“å‰æ–‡æ¡£
â”‚   â”œâ”€â”€ backup.docx         # å¤‡ä»½æ–‡æ¡£
â”‚   â””â”€â”€ metadata.json       # ä¼šè¯å…ƒæ•°æ®
â”œâ”€â”€ session-def456/
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

**æ¸…ç†ç­–ç•¥**:
- ä¼šè¯ç»“æŸåç«‹å³æ¸…ç†
- å®šæ—¶æ¸…ç†è¶…è¿‡1å°æ—¶çš„ä¼šè¯
- æœåŠ¡é‡å¯æ—¶æ¸…ç†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶

---

## AIå¯¹è¯é›†æˆ

### LLMé›†æˆæ–¹æ¡ˆ

**ç›®æ ‡**: è®©AIç†è§£ç”¨æˆ·æ„å›¾å¹¶è‡ªåŠ¨è°ƒç”¨MCPå·¥å…·

#### æ”¯æŒçš„LLM

| LLM | API | Function Calling | æ¨èåº¦ |
|-----|-----|-----------------|--------|
| **OpenAI GPT-4** | âœ… | âœ… åŸç”Ÿæ”¯æŒ | â­â­â­â­â­ |
| **Claude 3.5** | âœ… | âœ… åŸç”Ÿæ”¯æŒ | â­â­â­â­â­ |
| **Azure OpenAI** | âœ… | âœ… åŸç”Ÿæ”¯æŒ | â­â­â­â­ |
| **æœ¬åœ°æ¨¡å‹** | âœ… | âš ï¸ éœ€è¦é€‚é… | â­â­â­ |

#### å·¥å…·è½¬æ¢æœºåˆ¶

å°†MCPå·¥å…·åˆ—è¡¨è½¬æ¢ä¸ºLLMçš„Function Callingæ ¼å¼:

**MCPå·¥å…·å®šä¹‰** (ç°æœ‰æ ¼å¼):
```python
@mcp.tool()
def format_word_text(
    filename: str,
    paragraph_index: int,
    font_name: Optional[str] = None,
    bold: bool = False,
    color: Optional[str] = None
) -> dict[str, Any]:
    """æ ¼å¼åŒ–Wordæ–‡æœ¬"""
    pass
```

**è½¬æ¢ä¸ºOpenAIæ ¼å¼**:
```json
{
  "type": "function",
  "function": {
    "name": "format_word_text",
    "description": "æ ¼å¼åŒ–Wordæ–‡æœ¬",
    "parameters": {
      "type": "object",
      "properties": {
        "filename": { "type": "string", "description": "æ–‡ä»¶å" },
        "paragraph_index": { "type": "integer", "description": "æ®µè½ç´¢å¼•" },
        "font_name": { "type": "string", "description": "å­—ä½“åç§°" },
        "bold": { "type": "boolean", "description": "æ˜¯å¦åŠ ç²—" },
        "color": { "type": "string", "description": "é¢œè‰²HEXå€¼" }
      },
      "required": ["filename", "paragraph_index"]
    }
  }
}
```

#### AIå¯¹è¯æµç¨‹

```typescript
// Bridge Server ä¸­çš„AIå¯¹è¯å¤„ç†
async function handleChatMessage(
  sessionId: string,
  userMessage: string,
  documentData: Buffer
): Promise<ChatResponse> {

  // 1. ä¿å­˜æ–‡æ¡£åˆ°ä¸´æ—¶æ–‡ä»¶
  const tempFile = await saveTempDocument(sessionId, documentData);

  // 2. è·å–MCPå·¥å…·åˆ—è¡¨
  const tools = await mcpClient.listTools();

  // 3. è½¬æ¢ä¸ºLLMæ ¼å¼
  const llmTools = convertToLLMFormat(tools);

  // 4. è°ƒç”¨LLM API
  const llmResponse = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [
      { role: "system", content: SYSTEM_PROMPT },
      { role: "user", content: userMessage }
    ],
    tools: llmTools,
    tool_choice: "auto"
  });

  // 5. å¤„ç†LLMè¿”å›çš„å·¥å…·è°ƒç”¨
  const toolCalls = llmResponse.choices[0].message.tool_calls;

  if (toolCalls) {
    for (const toolCall of toolCalls) {
      // 6. æ‰§è¡ŒMCPå·¥å…·
      const result = await mcpClient.callTool(
        toolCall.function.name,
        JSON.parse(toolCall.function.arguments)
      );

      // 7. é€šè¿‡WebSocketæ¨é€è¿›åº¦
      wsServer.send(sessionId, {
        type: 'progress',
        tool: toolCall.function.name,
        result: result
      });
    }
  }

  // 8. è¯»å–å¤„ç†åçš„æ–‡æ¡£
  const resultData = await readTempDocument(sessionId);

  // 9. è¿”å›ç»“æœ
  return {
    success: true,
    message: llmResponse.choices[0].message.content,
    documentData: resultData
  };
}
```

#### System Prompt è®¾è®¡

```
ä½ æ˜¯ä¸€ä¸ªOfficeæ–‡æ¡£å¤„ç†åŠ©æ‰‹,å¯ä»¥å¸®åŠ©ç”¨æˆ·ç¼–è¾‘Wordã€Excelå’ŒPowerPointæ–‡æ¡£ã€‚

å¯ç”¨å·¥å…·:
- Wordå·¥å…·: 59ä¸ª(æ–‡æ¡£åˆ›å»ºã€æ ¼å¼åŒ–ã€è¡¨æ ¼ã€å›¾ç‰‡ç­‰)
- Excelå·¥å…·: 91ä¸ª(æ•°æ®æ“ä½œã€å…¬å¼ã€å›¾è¡¨ã€åˆ†æç­‰)
- PowerPointå·¥å…·: 34ä¸ª(å¹»ç¯ç‰‡ç®¡ç†ã€å†…å®¹ç¼–è¾‘ã€æ ·å¼ç­‰)

å½“å‰æ–‡æ¡£: {documentType} - {filename}

ç”¨æˆ·æŒ‡ä»¤å¤„ç†è§„åˆ™:
1. ç†è§£ç”¨æˆ·æ„å›¾,é€‰æ‹©åˆé€‚çš„å·¥å…·
2. å¦‚æœéœ€è¦å¤šä¸ªæ­¥éª¤,æŒ‰é¡ºåºè°ƒç”¨å·¥å…·
3. å‚æ•°è¦å‡†ç¡®,ç‰¹åˆ«æ˜¯ç´¢å¼•(ä»0å¼€å§‹)
4. é¢œè‰²ä½¿ç”¨HEXæ ¼å¼(å¦‚#FF0000)
5. æ“ä½œå®Œæˆåç»™å‡ºæ¸…æ™°çš„åé¦ˆ

ç¤ºä¾‹:
ç”¨æˆ·: "æŠŠç¬¬ä¸€æ®µåŠ ç²—"
å·¥å…·è°ƒç”¨: format_word_text(filename="current.docx", paragraph_index=0, bold=true)
```

### å®æ—¶åé¦ˆæœºåˆ¶

#### WebSocketé€šä¿¡

```typescript
// å®¢æˆ·ç«¯(æ’ä»¶)
const ws = new WebSocket(`ws://localhost:3000/ws/session/${sessionId}`);

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);

  switch (data.type) {
    case 'progress':
      // æ˜¾ç¤ºè¿›åº¦: "æ­£åœ¨æ‰§è¡Œ format_word_text..."
      showProgress(data.tool);
      break;

    case 'complete':
      // æ›´æ–°æ–‡æ¡£
      await updateDocument(data.documentData);
      showSuccess("æ“ä½œå®Œæˆ!");
      break;

    case 'error':
      // æ˜¾ç¤ºé”™è¯¯
      showError(data.message);
      break;
  }
};

// å‘é€æ¶ˆæ¯
ws.send(JSON.stringify({
  type: 'chat',
  message: userInput
}));
```

#### è¿›åº¦æ˜¾ç¤º

```
ç”¨æˆ·è¾“å…¥: "åˆ›å»ºä¸€ä¸ªåŒ…å«é”€å”®æ•°æ®çš„è¡¨æ ¼,å¹¶ç”ŸæˆæŸ±çŠ¶å›¾"

è¿›åº¦æ˜¾ç¤º:
[1/3] æ­£åœ¨åˆ›å»ºè¡¨æ ¼... âœ“
[2/3] æ­£åœ¨å¡«å……æ•°æ®... âœ“
[3/3] æ­£åœ¨ç”Ÿæˆå›¾è¡¨... âœ“

å®Œæˆ! å·²åˆ›å»ºåŒ…å«é”€å”®æ•°æ®çš„è¡¨æ ¼å’ŒæŸ±çŠ¶å›¾ã€‚
```

### æ‰¹é‡æ“ä½œä¼˜åŒ–

å¯¹äºéœ€è¦å¤šæ¬¡è°ƒç”¨çš„åœºæ™¯,è¿›è¡Œæ‰¹é‡ä¼˜åŒ–:

```typescript
// ç”¨æˆ·: "å°†å‰5æ®µæ–‡å­—éƒ½æ”¹ä¸ºè“è‰²"

// ä½æ•ˆæ–¹å¼: è°ƒç”¨5æ¬¡
for (let i = 0; i < 5; i++) {
  await format_word_text({ paragraph_index: i, color: "#0000FF" });
}

// ä¼˜åŒ–æ–¹å¼: ä½¿ç”¨æ‰¹é‡å·¥å…·(å¦‚æœMCPæœåŠ¡æ”¯æŒ)
await batch_format_word_text({
  paragraph_indices: [0, 1, 2, 3, 4],
  color: "#0000FF"
});

// æˆ–è€…: åœ¨Bridge Serverå±‚é¢åˆå¹¶æ“ä½œ
await mcpClient.batchCall([
  { tool: "format_word_text", args: { paragraph_index: 0, color: "#0000FF" } },
  { tool: "format_word_text", args: { paragraph_index: 1, color: "#0000FF" } },
  // ...
]);
```

---

## å¯è¡Œæ€§åˆ†æ

### æŠ€æœ¯å¯è¡Œæ€§

| æŠ€æœ¯ç‚¹ | å¯è¡Œæ€§ | é£é™©ç­‰çº§ | è¯´æ˜ |
|--------|--------|---------|------|
| **Office Add-inå¼€å‘** | âœ… é«˜ | ğŸŸ¢ ä½ | æˆç†ŸæŠ€æœ¯,æ–‡æ¡£å®Œå–„ |
| **Office.js API** | âœ… é«˜ | ğŸŸ¢ ä½ | å®˜æ–¹æ”¯æŒ,åŠŸèƒ½å®Œæ•´ |
| **MCP stdioé€šä¿¡** | âœ… é«˜ | ğŸŸ¡ ä¸­ | éœ€è¦å°è£…,ä½†å¯å®ç° |
| **æ–‡æ¡£åŒæ­¥** | âœ… é«˜ | ğŸŸ¡ ä¸­ | å¤§æ–‡æ¡£æ€§èƒ½éœ€ä¼˜åŒ– |
| **LLMé›†æˆ** | âœ… é«˜ | ğŸŸ¢ ä½ | æˆç†ŸAPI,æ˜“äºé›†æˆ |
| **WebSocketå®æ—¶é€šä¿¡** | âœ… é«˜ | ğŸŸ¢ ä½ | æ ‡å‡†æŠ€æœ¯ |

### æ€§èƒ½åˆ†æ

#### é¢„æœŸæ€§èƒ½æŒ‡æ ‡

| æ“ä½œ | é¢„æœŸè€—æ—¶ | ä¼˜åŒ–ç›®æ ‡ |
|------|---------|---------|
| **æ–‡æ¡£è¯»å–** | 100-500ms | <200ms |
| **MCPå·¥å…·è°ƒç”¨** | 50-200ms | <100ms |
| **LLMå“åº”** | 1-3s | <2s |
| **æ–‡æ¡£æ›´æ–°** | 100-500ms | <200ms |
| **ç«¯åˆ°ç«¯** | 2-5s | <3s |

#### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

1. **æ–‡æ¡£ç¼“å­˜**: ç¼“å­˜æ–‡æ¡£çŠ¶æ€,å‡å°‘é‡å¤è¯»å–
2. **å¢é‡æ›´æ–°**: åªä¼ è¾“å˜åŒ–éƒ¨åˆ†
3. **å¹¶è¡Œå¤„ç†**: å¤šä¸ªå·¥å…·è°ƒç”¨å¹¶è¡Œæ‰§è¡Œ
4. **æµå¼å“åº”**: LLMä½¿ç”¨æµå¼API,å®æ—¶æ˜¾ç¤º
5. **é¢„åŠ è½½**: é¢„åŠ è½½å¸¸ç”¨å·¥å…·å®šä¹‰

### å®‰å…¨æ€§åˆ†æ

#### æ½œåœ¨å®‰å…¨é£é™©

| é£é™© | ç­‰çº§ | ç¼“è§£æªæ–½ |
|------|------|---------|
| **æœ¬åœ°HTTPæœåŠ¡æš´éœ²** | ğŸŸ¡ ä¸­ | åªç›‘å¬localhost,ä¸å¯¹å¤–å¼€æ”¾ |
| **æ–‡ä»¶è®¿é—®æƒé™** | ğŸŸ¡ ä¸­ | é™åˆ¶ä¸´æ—¶æ–‡ä»¶ç›®å½•æƒé™ |
| **LLM APIå¯†é’¥æ³„éœ²** | ğŸ”´ é«˜ | ä½¿ç”¨ç¯å¢ƒå˜é‡,ä¸ç¡¬ç¼–ç  |
| **æ¶æ„å·¥å…·è°ƒç”¨** | ğŸŸ¡ ä¸­ | å·¥å…·è°ƒç”¨ç™½åå•,å‚æ•°éªŒè¯ |
| **ä¼šè¯åŠ«æŒ** | ğŸŸ¡ ä¸­ | ä½¿ç”¨tokenè®¤è¯,HTTPSåŠ å¯† |

#### å®‰å…¨æªæ–½

```typescript
// 1. Tokenè®¤è¯
const sessionToken = crypto.randomBytes(32).toString('hex');

// 2. è¯·æ±‚éªŒè¯
app.use((req, res, next) => {
  const token = req.headers['x-session-token'];
  if (!validateToken(token)) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  next();
});

// 3. å·¥å…·è°ƒç”¨ç™½åå•
const ALLOWED_TOOLS = [
  'create_word_document',
  'format_word_text',
  // ... å…¶ä»–å®‰å…¨å·¥å…·
];

function validateToolCall(toolName: string) {
  return ALLOWED_TOOLS.includes(toolName);
}

// 4. å‚æ•°éªŒè¯
function validateToolArgs(toolName: string, args: any) {
  // éªŒè¯å‚æ•°ç±»å‹å’ŒèŒƒå›´
  // é˜²æ­¢è·¯å¾„éå†æ”»å‡»
  // é˜²æ­¢æ³¨å…¥æ”»å‡»
}
```

### å…¼å®¹æ€§åˆ†æ

#### Officeç‰ˆæœ¬æ”¯æŒ

| Officeç‰ˆæœ¬ | Windows | Mac | Web | æ”¯æŒåº¦ |
|-----------|---------|-----|-----|--------|
| **Office 2016+** | âœ… | âœ… | âœ… | å®Œå…¨æ”¯æŒ |
| **Office 2013** | âš ï¸ | âŒ | âŒ | éƒ¨åˆ†æ”¯æŒ |
| **Office 365** | âœ… | âœ… | âœ… | å®Œå…¨æ”¯æŒ |

#### æµè§ˆå™¨æ”¯æŒ(Webç‰ˆ)

- âœ… Chrome 90+
- âœ… Edge 90+
- âœ… Firefox 88+
- âœ… Safari 14+

---

## å¼€å‘ç»„ä»¶æ¸…å•

### 1. Office Add-in å‰ç«¯

**æŠ€æœ¯æ ˆ**: React + TypeScript + Office.js

**ç›®å½•ç»“æ„**:
```
office-ai-addin/
â”œâ”€â”€ manifest.xml              # Add-inæ¸…å•æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ taskpane/
â”‚   â”‚   â”œâ”€â”€ App.tsx           # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ChatPanel.tsx     # AIå¯¹è¯é¢æ¿
â”‚   â”‚   â”œâ”€â”€ ProgressBar.tsx   # è¿›åº¦æ˜¾ç¤º
â”‚   â”‚   â””â”€â”€ DocumentViewer.tsx # æ–‡æ¡£é¢„è§ˆ
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ OfficeService.ts  # Office.jså°è£…
â”‚   â”‚   â”œâ”€â”€ ApiClient.ts      # HTTPå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ WebSocketClient.ts # WebSocketå®¢æˆ·ç«¯
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ documentParser.ts # æ–‡æ¡£è§£æ
â”‚       â””â”€â”€ errorHandler.ts   # é”™è¯¯å¤„ç†
â”œâ”€â”€ package.json
â””â”€â”€ webpack.config.js
```

**æ ¸å¿ƒæ–‡ä»¶**:

`manifest.xml`:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<OfficeApp xmlns="http://schemas.microsoft.com/office/appforoffice/1.1">
  <Id>12345678-1234-1234-1234-123456789012</Id>
  <Version>1.0.0.0</Version>
  <ProviderName>Your Company</ProviderName>
  <DefaultLocale>zh-CN</DefaultLocale>
  <DisplayName DefaultValue="Office AI Assistant"/>
  <Description DefaultValue="AI-powered document editing"/>

  <Hosts>
    <Host Name="Document"/>  <!-- Word -->
    <Host Name="Workbook"/>  <!-- Excel -->
    <Host Name="Presentation"/> <!-- PowerPoint -->
  </Hosts>

  <DefaultSettings>
    <SourceLocation DefaultValue="https://localhost:3000/taskpane.html"/>
  </DefaultSettings>

  <Permissions>ReadWriteDocument</Permissions>
</OfficeApp>
```

### 2. Bridge Server

**æŠ€æœ¯æ ˆ**: Node.js + Express + TypeScript (æ¨è)

**ç›®å½•ç»“æ„**:
```
bridge-server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.ts             # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ chat.ts           # AIå¯¹è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ document.ts       # æ–‡æ¡£æ“ä½œè·¯ç”±
â”‚   â”‚   â””â”€â”€ tools.ts          # å·¥å…·ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ MCPClient.ts      # MCPå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ LLMService.ts     # LLMé›†æˆ
â”‚   â”‚   â”œâ”€â”€ FileManager.ts    # æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â””â”€â”€ SessionManager.ts # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ websocket/
â”‚   â”‚   â””â”€â”€ WebSocketServer.ts # WebSocketæœåŠ¡
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ toolConverter.ts  # å·¥å…·æ ¼å¼è½¬æ¢
â”‚       â””â”€â”€ logger.ts         # æ—¥å¿—
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**æ ¸å¿ƒå®ç°**:

`MCPClient.ts`:
```typescript
import { spawn, ChildProcess } from 'child_process';

export class MCPClient {
  private process: ChildProcess;
  private requestId = 0;
  private pendingRequests = new Map<number, any>();

  constructor(pythonPath: string, mcpServerPath: string) {
    // å¯åŠ¨MCPæœåŠ¡è¿›ç¨‹
    this.process = spawn(pythonPath, [mcpServerPath]);

    // ç›‘å¬stdout
    this.process.stdout?.on('data', (data) => {
      this.handleResponse(data.toString());
    });
  }

  async callTool(name: string, args: any): Promise<any> {
    const id = ++this.requestId;

    const request = {
      jsonrpc: "2.0",
      method: "tools/call",
      params: { name, arguments: args },
      id
    };

    return new Promise((resolve, reject) => {
      this.pendingRequests.set(id, { resolve, reject });
      this.process.stdin?.write(JSON.stringify(request) + '\n');
    });
  }

  private handleResponse(data: string) {
    const response = JSON.parse(data);
    const pending = this.pendingRequests.get(response.id);

    if (pending) {
      if (response.error) {
        pending.reject(response.error);
      } else {
        pending.resolve(response.result);
      }
      this.pendingRequests.delete(response.id);
    }
  }
}
```

### 3. æ–‡æ¡£é€‚é…å™¨

**ç›®çš„**: ç»Ÿä¸€ä¸åŒOfficeåº”ç”¨çš„APIå·®å¼‚

```typescript
// DocumentAdapter.ts
export interface IDocumentAdapter {
  getDocumentData(): Promise<Buffer>;
  updateDocument(data: Buffer): Promise<void>;
  getDocumentType(): 'word' | 'excel' | 'powerpoint';
}

// WordAdapter.ts
export class WordAdapter implements IDocumentAdapter {
  async getDocumentData(): Promise<Buffer> {
    return new Promise((resolve, reject) => {
      Office.context.document.getFileAsync(
        Office.FileType.Compressed,
        (result) => {
          if (result.status === Office.AsyncResultStatus.Succeeded) {
            const file = result.value;
            // è¯»å–æ–‡ä»¶åˆ‡ç‰‡å¹¶åˆå¹¶
            this.readFileSlices(file).then(resolve).catch(reject);
          } else {
            reject(result.error);
          }
        }
      );
    });
  }

  async updateDocument(data: Buffer): Promise<void> {
    // å®ç°æ–‡æ¡£æ›´æ–°é€»è¾‘
  }

  getDocumentType() {
    return 'word' as const;
  }
}

// ExcelAdapter.ts, PowerPointAdapter.ts ç±»ä¼¼å®ç°
```

### 4. é…ç½®æ–‡ä»¶

**Bridge Serveré…ç½®** (`config.json`):
```json
{
  "server": {
    "port": 3000,
    "host": "localhost"
  },
  "mcp": {
    "pythonPath": "python",
    "serverPath": "C:/path/to/office-mcp-server/src/office_mcp_server/main.py",
    "outputDir": "C:/path/to/office-mcp-server/output"
  },
  "llm": {
    "provider": "openai",
    "apiKey": "${OPENAI_API_KEY}",
    "model": "gpt-4",
    "temperature": 0.7
  },
  "session": {
    "tempDir": "./temp/sessions",
    "maxAge": 3600000,
    "cleanupInterval": 300000
  },
  "security": {
    "enableAuth": true,
    "allowedOrigins": ["https://localhost:3000"]
  }
}
```

---

## å®æ–½æ­¥éª¤

### é˜¶æ®µ1: åŸºç¡€æ¶æ„æ­å»º (2å‘¨)

**ç›®æ ‡**: å»ºç«‹åŸºæœ¬çš„é€šä¿¡é“¾è·¯

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºOffice Add-iné¡¹ç›®
  ```bash
  yo office --projectType taskpane --name "Office AI Assistant" --host word --ts
  ```
- [ ] æ­å»ºBridge Server
  ```bash
  npm init -y
  npm install express typescript @types/node @types/express
  ```
- [ ] å®ç°MCP ClientåŸºç¡€é€šä¿¡
- [ ] æµ‹è¯•æ’ä»¶â†’Bridgeâ†’MCPå®Œæ•´é“¾è·¯

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ’ä»¶èƒ½æˆåŠŸåŠ è½½åˆ°Office
- âœ… Bridge Serverèƒ½å¯åŠ¨å¹¶å“åº”HTTPè¯·æ±‚
- âœ… MCP Clientèƒ½æˆåŠŸè°ƒç”¨ä¸€ä¸ªç®€å•å·¥å…·(å¦‚get_server_info)

### é˜¶æ®µ2: æ–‡æ¡£åŒæ­¥æœºåˆ¶ (2å‘¨)

**ç›®æ ‡**: å®ç°æ–‡æ¡£çš„è¯»å–å’Œæ›´æ–°

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç°Wordæ–‡æ¡£è¯»å–(Office.js)
- [ ] å®ç°ä¸´æ—¶æ–‡ä»¶ç®¡ç†
- [ ] å®ç°MCPå·¥å…·è°ƒç”¨(format_word_text)
- [ ] å®ç°æ–‡æ¡£æ›´æ–°(Office.js)
- [ ] æµ‹è¯•å®Œæ•´çš„æ–‡æ¡£æ“ä½œæµç¨‹

**éªŒæ”¶æ ‡å‡†**:
- âœ… èƒ½è¯»å–å½“å‰Wordæ–‡æ¡£å†…å®¹
- âœ… èƒ½è°ƒç”¨MCPæœåŠ¡ä¿®æ”¹æ–‡æ¡£
- âœ… èƒ½å°†ä¿®æ”¹åçš„æ–‡æ¡£æ›´æ–°å›Office
- âœ… ç”¨æˆ·èƒ½çœ‹åˆ°å®æ—¶å˜åŒ–

### é˜¶æ®µ3: AIå¯¹è¯é›†æˆ (3å‘¨)

**ç›®æ ‡**: å®ç°AIé©±åŠ¨çš„æ–‡æ¡£æ“ä½œ

**ä»»åŠ¡æ¸…å•**:
- [ ] é›†æˆOpenAI/Claude API
- [ ] å®ç°MCPå·¥å…·â†’LLM Functionæ ¼å¼è½¬æ¢
- [ ] å®ç°AIæ„å›¾è¯†åˆ«å’Œå·¥å…·è°ƒç”¨
- [ ] å¼€å‘å¯¹è¯ç•Œé¢UI
- [ ] å®ç°æµå¼å“åº”å’Œè¿›åº¦æ˜¾ç¤º
- [ ] å®ç°WebSocketå®æ—¶é€šä¿¡

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç”¨æˆ·èƒ½é€šè¿‡è‡ªç„¶è¯­è¨€æ“ä½œæ–‡æ¡£
- âœ… AIèƒ½æ­£ç¡®ç†è§£æ„å›¾å¹¶è°ƒç”¨å·¥å…·
- âœ… èƒ½å®æ—¶æ˜¾ç¤ºæ“ä½œè¿›åº¦
- âœ… èƒ½å¤„ç†å¤æ‚çš„å¤šæ­¥éª¤æ“ä½œ

**ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹**:
```
ç”¨æˆ·: "è¯·åˆ›å»ºä¸€ä¸ªæ ‡é¢˜ä¸º'é”€å”®æŠ¥å‘Š'çš„æ–‡æ¡£,ç¬¬ä¸€æ®µå†™'2024å¹´é”€å”®æ€»ç»“',å¹¶å°†æ ‡é¢˜å±…ä¸­"

é¢„æœŸç»“æœ:
1. è°ƒç”¨ create_word_document(filename="é”€å”®æŠ¥å‘Š.docx", title="é”€å”®æŠ¥å‘Š")
2. è°ƒç”¨ insert_text(filename="é”€å”®æŠ¥å‘Š.docx", text="2024å¹´é”€å”®æ€»ç»“")
3. è°ƒç”¨ format_paragraph(filename="é”€å”®æŠ¥å‘Š.docx", paragraph_index=0, alignment="center")
4. æ–‡æ¡£æˆåŠŸåˆ›å»ºå¹¶æ˜¾ç¤ºåœ¨Officeä¸­
```

### é˜¶æ®µ4: åŠŸèƒ½å®Œå–„ (2å‘¨)

**ç›®æ ‡**: æ”¯æŒExcelå’ŒPowerPoint,ä¼˜åŒ–æ€§èƒ½

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç°ExcelAdapter
- [ ] å®ç°PowerPointAdapter
- [ ] å®ç°æ‰¹é‡æ“ä½œä¼˜åŒ–
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- [ ] æ€§èƒ½ä¼˜åŒ–(ç¼“å­˜ã€å¢é‡æ›´æ–°)
- [ ] æ·»åŠ æ“ä½œå†å²å’Œæ’¤é”€åŠŸèƒ½

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ”¯æŒWordã€Excelã€PowerPointä¸‰ç§æ–‡æ¡£
- âœ… æ‰¹é‡æ“ä½œæ€§èƒ½æå‡50%ä»¥ä¸Š
- âœ… é”™è¯¯ç‡<5%
- âœ… ç«¯åˆ°ç«¯å“åº”æ—¶é—´<3ç§’

### é˜¶æ®µ5: æµ‹è¯•å’Œéƒ¨ç½² (1å‘¨)

**ç›®æ ‡**: å®Œæˆæµ‹è¯•å¹¶å‡†å¤‡å‘å¸ƒ

**ä»»åŠ¡æ¸…å•**:
- [ ] å•å…ƒæµ‹è¯•(è¦†ç›–ç‡>80%)
- [ ] é›†æˆæµ‹è¯•
- [ ] ç”¨æˆ·éªŒæ”¶æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å®‰å…¨æµ‹è¯•
- [ ] ç¼–å†™éƒ¨ç½²æ–‡æ¡£
- [ ] å‡†å¤‡å‘å¸ƒåˆ°Office Store(å¯é€‰)

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- âœ… å®‰å…¨å®¡è®¡é€šè¿‡
- âœ… æ–‡æ¡£å®Œæ•´

---

## æŠ€æœ¯é€‰å‹

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | é€‰æ‹© | ç†ç”± |
|------|------|------|
| **æ¡†æ¶** | React | ç”Ÿæ€æˆç†Ÿ,Office Add-inå®˜æ–¹æ¨è |
| **è¯­è¨€** | TypeScript | ç±»å‹å®‰å…¨,æé«˜ä»£ç è´¨é‡ |
| **UIåº“** | Fluent UI | Microsoftå®˜æ–¹UIåº“,ä¸Officeé£æ ¼ä¸€è‡´ |
| **çŠ¶æ€ç®¡ç†** | Zustand | è½»é‡çº§,æ˜“äºä½¿ç”¨ |
| **HTTPå®¢æˆ·ç«¯** | Axios | åŠŸèƒ½å®Œå–„,æ˜“äºæ‹¦æˆªå’Œé”™è¯¯å¤„ç† |
| **WebSocket** | native WebSocket | åŸç”Ÿæ”¯æŒ,æ— éœ€é¢å¤–ä¾èµ– |

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | é€‰æ‹© | ç†ç”± |
|------|------|------|
| **è¿è¡Œæ—¶** | Node.js 18+ | ä¸å‰ç«¯æŠ€æœ¯æ ˆç»Ÿä¸€,ç”Ÿæ€ä¸°å¯Œ |
| **æ¡†æ¶** | Express | æˆç†Ÿç¨³å®š,ä¸­é—´ä»¶ä¸°å¯Œ |
| **è¯­è¨€** | TypeScript | ç±»å‹å®‰å…¨,ä¸å‰ç«¯ç»Ÿä¸€ |
| **WebSocket** | ws | è½»é‡çº§,æ€§èƒ½å¥½ |
| **è¿›ç¨‹ç®¡ç†** | child_process | Node.jsåŸç”Ÿ,è°ƒç”¨Python MCPæœåŠ¡ |
| **æ–‡ä»¶æ“ä½œ** | fs-extra | å¢å¼ºçš„æ–‡ä»¶ç³»ç»ŸAPI |

### LLMé€‰æ‹©

| LLM | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ¨èåœºæ™¯ |
|-----|------|------|---------|
| **OpenAI GPT-4** | Function Callingå¼ºå¤§,å“åº”å¿« | éœ€è¦ä»˜è´¹,æœ‰APIé™åˆ¶ | ç”Ÿäº§ç¯å¢ƒ |
| **Claude 3.5** | ä¸Šä¸‹æ–‡é•¿,ç†è§£èƒ½åŠ›å¼º | éœ€è¦ä»˜è´¹ | å¤æ‚æ–‡æ¡£å¤„ç† |
| **Azure OpenAI** | ä¼ä¸šçº§æ”¯æŒ,æ•°æ®éšç§å¥½ | éœ€è¦ä¼ä¸šè´¦å· | ä¼ä¸šéƒ¨ç½² |
| **æœ¬åœ°æ¨¡å‹** | å…è´¹,æ•°æ®ç§æœ‰ | æ€§èƒ½è¾ƒå¼±,éœ€è¦GPU | å¼€å‘æµ‹è¯• |

**æ¨èæ–¹æ¡ˆ**:
- å¼€å‘é˜¶æ®µ: OpenAI GPT-4 (å¿«é€ŸéªŒè¯)
- ç”Ÿäº§ç¯å¢ƒ: æ”¯æŒå¤šç§LLM,ç”¨æˆ·å¯é…ç½®

---

## é™„å½•

### A. å…³é”®ä»£ç ç¤ºä¾‹

#### æ’ä»¶ç«¯å®Œæ•´ç¤ºä¾‹

```typescript
// src/taskpane/App.tsx
import React, { useState, useEffect } from 'react';
import { ApiClient } from '../services/ApiClient';
import { WordAdapter } from '../services/WordAdapter';

export const App: React.FC = () => {
  const [message, setMessage] = useState('');
  const [chatHistory, setChatHistory] = useState<any[]>([]);
  const [loading, setLoading] = useState(false);

  const apiClient = new ApiClient('http://localhost:3000');
  const wordAdapter = new WordAdapter();

  const handleSendMessage = async () => {
    if (!message.trim()) return;

    setLoading(true);
    try {
      // 1. è¯»å–å½“å‰æ–‡æ¡£
      const documentData = await wordAdapter.getDocumentData();

      // 2. å‘é€åˆ°Bridge Server
      const response = await apiClient.chat({
        message,
        documentData,
        documentType: 'word'
      });

      // 3. æ›´æ–°æ–‡æ¡£
      if (response.documentData) {
        await wordAdapter.updateDocument(response.documentData);
      }

      // 4. æ›´æ–°èŠå¤©å†å²
      setChatHistory([
        ...chatHistory,
        { role: 'user', content: message },
        { role: 'assistant', content: response.message }
      ]);

      setMessage('');
    } catch (error) {
      console.error('Error:', error);
      alert('æ“ä½œå¤±è´¥: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="app">
      <div className="chat-history">
        {chatHistory.map((msg, i) => (
          <div key={i} className={`message ${msg.role}`}>
            {msg.content}
          </div>
        ))}
      </div>

      <div className="input-area">
        <input
          type="text"
          value={message}
          onChange={(e) => setMessage(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
          placeholder="è¾“å…¥æŒ‡ä»¤,å¦‚: å°†ç¬¬ä¸€æ®µåŠ ç²—"
          disabled={loading}
        />
        <button onClick={handleSendMessage} disabled={loading}>
          {loading ? 'å¤„ç†ä¸­...' : 'å‘é€'}
        </button>
      </div>
    </div>
  );
};
```

### B. éƒ¨ç½²æ¸…å•

#### å¼€å‘ç¯å¢ƒ

```bash
# 1. å®‰è£…ä¾èµ–
cd office-ai-addin && npm install
cd ../bridge-server && npm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘.env,è®¾ç½®OPENAI_API_KEYç­‰

# 3. å¯åŠ¨Bridge Server
cd bridge-server
npm run dev

# 4. å¯åŠ¨Add-inå¼€å‘æœåŠ¡å™¨
cd office-ai-addin
npm start

# 5. åœ¨Officeä¸­åŠ è½½Add-in
# Word â†’ æ’å…¥ â†’ åŠ è½½é¡¹ â†’ æˆ‘çš„åŠ è½½é¡¹ â†’ ä¸Šä¼ æ¸…å•æ–‡ä»¶
```

#### ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. æ„å»ºå‰ç«¯
cd office-ai-addin
npm run build

# 2. æ„å»ºåç«¯
cd bridge-server
npm run build

# 3. éƒ¨ç½²åˆ°æœåŠ¡å™¨
# - å‰ç«¯: éƒ¨ç½²åˆ°é™æ€æ–‡ä»¶æœåŠ¡å™¨(Nginx/CDN)
# - åç«¯: éƒ¨ç½²åˆ°Node.jsæœåŠ¡å™¨(PM2ç®¡ç†)

# 4. é…ç½®HTTPS
# - ä½¿ç”¨Let's Encryptè·å–SSLè¯ä¹¦
# - é…ç½®Nginxåå‘ä»£ç†

# 5. å‘å¸ƒAdd-in
# - æ›´æ–°manifest.xmlä¸­çš„SourceLocationä¸ºç”Ÿäº§URL
# - æäº¤åˆ°Office Storeæˆ–ä¼ä¸šå†…éƒ¨éƒ¨ç½²
```

### C. å¸¸è§é—®é¢˜

**Q1: MCPæœåŠ¡è°ƒç”¨å¤±è´¥æ€ä¹ˆåŠ?**

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:
1. MCPæœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
2. Bridge Serverçš„MCP Clienté…ç½®æ˜¯å¦æ­£ç¡®
3. ä¸´æ—¶æ–‡ä»¶è·¯å¾„æ˜¯å¦æœ‰æƒé™
4. æŸ¥çœ‹MCPæœåŠ¡æ—¥å¿—(logs/office_mcp_server.log)

**Q2: æ–‡æ¡£æ›´æ–°åOfficeä¸­çœ‹ä¸åˆ°å˜åŒ–?**

A: å¯èƒ½åŸå› :
1. Office.js APIè°ƒç”¨å¤±è´¥,æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
2. æ–‡æ¡£æ ¼å¼ä¸å…¼å®¹,æ£€æŸ¥MCPæœåŠ¡è¿”å›çš„æ–‡ä»¶
3. ç¼“å­˜é—®é¢˜,å°è¯•åˆ·æ–°æ–‡æ¡£

**Q3: AIç†è§£é”™è¯¯,è°ƒç”¨äº†é”™è¯¯çš„å·¥å…·?**

A: ä¼˜åŒ–æ–¹æ¡ˆ:
1. æ”¹è¿›System Prompt,æä¾›æ›´å¤šç¤ºä¾‹
2. æ·»åŠ å·¥å…·æè¿°çš„è¯¦ç»†è¯´æ˜
3. å®ç°ç”¨æˆ·ç¡®è®¤æœºåˆ¶,æ‰§è¡Œå‰è¯¢é—®
4. æ”¶é›†é”™è¯¯æ¡ˆä¾‹,fine-tuneæ¨¡å‹

**Q4: æ€§èƒ½å¤ªæ…¢æ€ä¹ˆä¼˜åŒ–?**

A: ä¼˜åŒ–å»ºè®®:
1. ä½¿ç”¨å¢é‡æ–‡æ¡£åŒæ­¥
2. å¯ç”¨æ–‡æ¡£ç¼“å­˜
3. æ‰¹é‡æ“ä½œåˆå¹¶
4. ä½¿ç”¨æµå¼LLMå“åº”
5. è€ƒè™‘ä½¿ç”¨æ›´å¿«çš„LLMæ¨¡å‹

---

## æ€»ç»“

æœ¬æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡äº†ä¸€ä¸ªå®Œæ•´çš„Office AIæ’ä»¶ç³»ç»Ÿ,é€šè¿‡ä¸‰å±‚æ¶æ„å®ç°äº†:

âœ… **åŒå‘é€šä¿¡**: æ’ä»¶å¯è°ƒç”¨MCPæœåŠ¡,MCPå¯æ“ä½œå½“å‰æ–‡æ¡£
âœ… **AIé©±åŠ¨**: è‡ªç„¶è¯­è¨€æ§åˆ¶æ–‡æ¡£æ“ä½œ
âœ… **å®æ—¶åé¦ˆ**: WebSocketå®æ—¶æ˜¾ç¤ºæ“ä½œè¿›åº¦
âœ… **è·¨å¹³å°**: æ”¯æŒWindows/Mac/Webç‰ˆOffice
âœ… **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œæ–°åº”ç”¨æ”¯æŒ

**é¢„æœŸå¼€å‘å‘¨æœŸ**: 10å‘¨(2.5ä¸ªæœˆ)
**æŠ€æœ¯é£é™©**: ä½-ä¸­ç­‰
**å®æ–½éš¾åº¦**: ä¸­ç­‰

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. è¯„å®¡æŠ€æœ¯æ–¹æ¡ˆ
2. æ­å»ºå¼€å‘ç¯å¢ƒ
3. å¯åŠ¨é˜¶æ®µ1å¼€å‘
4. å®šæœŸreviewå’Œè°ƒæ•´

---

## ğŸ“Š æŠ€æœ¯æ–¹æ¡ˆå¯è¡Œæ€§éªŒè¯æŠ¥å‘Š

### éªŒè¯æ—¶é—´
2025-11-12

### éªŒè¯æ–¹æ³•
é€šè¿‡è”ç½‘æœç´¢éªŒè¯æŠ€æœ¯æ–¹æ¡ˆä¸­çš„å…³é”®æŠ€æœ¯ç‚¹,ç¡®è®¤æ‰€æœ‰æŠ€æœ¯é€‰å‹å’Œæ¶æ„è®¾è®¡çš„å¯è¡Œæ€§ã€‚

### éªŒè¯ç»“æœæ€»ç»“

âœ… **æ‰€æœ‰æ ¸å¿ƒæŠ€æœ¯ç‚¹å‡å·²éªŒè¯å¯è¡Œ** - æŠ€æœ¯æ–¹æ¡ˆå®Œå…¨å¯è¡Œ,å¯ä»¥å¼€å§‹å®æ–½

---

### è¯¦ç»†éªŒè¯ç»“æœ

#### 1. Office Add-in å¼€å‘ âœ… **å·²éªŒè¯**

**éªŒè¯æ¥æº**: Microsoftå®˜æ–¹æ–‡æ¡£ (learn.microsoft.com)

**å…³é”®å‘ç°**:
- âœ… Office Add-inæ˜¯Microsoftå®˜æ–¹æ”¯æŒçš„è·¨å¹³å°æ‰©å±•æŠ€æœ¯
- âœ… æ”¯æŒReact + TypeScriptæŠ€æœ¯æ ˆ(å®˜æ–¹æ¨è)
- âœ… æ”¯æŒWindowsã€Macã€Webç‰ˆOffice
- âœ… Office.js APIåŠŸèƒ½å®Œæ•´,æ–‡æ¡£é½å…¨
- âœ… å¯ä»¥é€šè¿‡Yeomanç”Ÿæˆå™¨å¿«é€Ÿåˆ›å»ºé¡¹ç›®: `yo office --projectType taskpane`

**å®˜æ–¹ç¤ºä¾‹**:
```bash
# å®˜æ–¹æ¨èçš„åˆ›å»ºæ–¹å¼
yo office --projectType taskpane --name "Office AI Assistant" --host word --ts
```

**ç»“è®º**: Office Add-inæŠ€æœ¯æˆç†Ÿç¨³å®š,å®Œå…¨æ”¯æŒæˆ‘ä»¬çš„éœ€æ±‚ã€‚

---

#### 2. MCP (Model Context Protocol) âœ… **å·²éªŒè¯**

**éªŒè¯æ¥æº**:
- Anthropicå®˜æ–¹MCPæ–‡æ¡£ (modelcontextprotocol.io)
- FastMCP GitHubä»“åº“ (20.2k stars)

**å…³é”®å‘ç°**:
- âœ… MCPæ˜¯Anthropicå¼€å‘çš„å¼€æ”¾æ ‡å‡†åè®®
- âœ… stdioä¼ è¾“æ–¹å¼æ˜¯æ ‡å‡†æ”¯æŒçš„é€šä¿¡æ–¹å¼
- âœ… FastMCPæ˜¯å®˜æ–¹æ¨èçš„Pythonå®ç°æ¡†æ¶
- âœ… æ”¯æŒå·¥å…·(Tools)ã€èµ„æº(Resources)ã€æç¤º(Prompts)ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½
- âœ… å·²æœ‰å¤§é‡ç”Ÿäº§ç¯å¢ƒåº”ç”¨æ¡ˆä¾‹

**FastMCPç‰¹æ€§**:
```python
# FastMCP 2.0 å®˜æ–¹ç¤ºä¾‹
from fastmcp import FastMCP

mcp = FastMCP("Demo Server")

@mcp.tool
def process_document(filename: str) -> dict:
    """å¤„ç†æ–‡æ¡£"""
    return {"success": True}

if __name__ == "__main__":
    mcp.run()  # é»˜è®¤ä½¿ç”¨stdioä¼ è¾“
```

**ç»“è®º**: MCPåè®®æˆç†Ÿ,FastMCPæ¡†æ¶å®Œå–„,å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ç°æœ‰MCPæœåŠ¡æ— éœ€ä¿®æ”¹ã€‚

---

#### 3. Node.jsè°ƒç”¨Pythonè¿›ç¨‹ âœ… **å·²éªŒè¯**

**éªŒè¯æ¥æº**: Stack Overflow + å®é™…æ¡ˆä¾‹

**å…³é”®å‘ç°**:
- âœ… Node.jsçš„`child_process.spawn()`æ˜¯æ ‡å‡†æ–¹æ³•
- âœ… å¯ä»¥é€šè¿‡stdin/stdoutè¿›è¡ŒJSONé€šä¿¡
- âœ… å·²æœ‰å¤§é‡ç”Ÿäº§ç¯å¢ƒåº”ç”¨
- âœ… æ”¯æŒè¿›ç¨‹ç®¡ç†å’Œé”™è¯¯å¤„ç†

**å®ç°ç¤ºä¾‹**:
```typescript
import { spawn } from 'child_process';

const mcpProcess = spawn('python', ['mcp_server.py']);

// å‘é€è¯·æ±‚åˆ°stdin
mcpProcess.stdin.write(JSON.stringify({
  jsonrpc: "2.0",
  method: "tools/call",
  params: { name: "format_word_text", arguments: {...} },
  id: 1
}) + '\n');

// ä»stdoutè¯»å–å“åº”
mcpProcess.stdout.on('data', (data) => {
  const response = JSON.parse(data.toString());
  console.log('MCPå“åº”:', response);
});
```

**ç»“è®º**: Node.jsä¸Pythoné€šè¿‡stdioé€šä¿¡æ˜¯æˆç†Ÿå¯é çš„æ–¹æ¡ˆã€‚

---

#### 4. Office.js æ–‡æ¡£è¯»å†™API âœ… **å·²éªŒè¯**

**éªŒè¯æ¥æº**: Microsoftå®˜æ–¹æ–‡æ¡£

**å…³é”®å‘ç°**:
- âœ… `Office.context.document.getFileAsync()` - è¯»å–æ–‡æ¡£
- âœ… `Office.context.document.setSelectedDataAsync()` - æ›´æ–°æ–‡æ¡£
- âœ… æ”¯æŒäºŒè¿›åˆ¶æ•°æ®ä¼ è¾“
- âœ… æ”¯æŒåˆ†ç‰‡è¯»å–å¤§æ–‡ä»¶
- âœ… APIç¨³å®š,å‘åå…¼å®¹

**å®˜æ–¹APIç¤ºä¾‹**:
```typescript
// è¯»å–æ–‡æ¡£
Office.context.document.getFileAsync(
  Office.FileType.Compressed,
  { sliceSize: 65536 },
  (result) => {
    if (result.status === Office.AsyncResultStatus.Succeeded) {
      const file = result.value;
      // å¤„ç†æ–‡ä»¶æ•°æ®
    }
  }
);

// æ›´æ–°æ–‡æ¡£
Office.context.document.setSelectedDataAsync(
  data,
  { coercionType: Office.CoercionType.Text },
  (result) => {
    if (result.status === Office.AsyncResultStatus.Succeeded) {
      console.log('æ–‡æ¡£æ›´æ–°æˆåŠŸ');
    }
  }
);
```

**ç»“è®º**: Office.jsæä¾›å®Œæ•´çš„æ–‡æ¡£è¯»å†™èƒ½åŠ›,æ”¯æŒæˆ‘ä»¬çš„æ–‡æ¡£åŒæ­¥éœ€æ±‚ã€‚

---

#### 5. OpenAI/Claude Function Calling âœ… **å·²éªŒè¯**

**éªŒè¯æ¥æº**: OpenAIå®˜æ–¹æ–‡æ¡£ + Redditç¤¾åŒºè®¨è®º

**å…³é”®å‘ç°**:
- âœ… OpenAI GPT-4åŸç”Ÿæ”¯æŒFunction Calling
- âœ… Claude 3.5åŸç”Ÿæ”¯æŒTool Use
- âœ… å¯ä»¥å°†MCPå·¥å…·è½¬æ¢ä¸ºLLMå‡½æ•°æ ¼å¼
- âœ… æ”¯æŒå¤šè½®å¯¹è¯å’Œå·¥å…·é“¾è°ƒç”¨
- âœ… å·²æœ‰å¤§é‡ç”Ÿäº§åº”ç”¨

**è½¬æ¢ç¤ºä¾‹**:
```typescript
// MCPå·¥å…·è½¬OpenAIæ ¼å¼
const openaiTools = mcpTools.map(tool => ({
  type: "function",
  function: {
    name: tool.name,
    description: tool.description,
    parameters: tool.inputSchema
  }
}));

// è°ƒç”¨OpenAI
const response = await openai.chat.completions.create({
  model: "gpt-4",
  messages: [...],
  tools: openaiTools,
  tool_choice: "auto"
});
```

**ç»“è®º**: LLM Function CallingæŠ€æœ¯æˆç†Ÿ,å®Œå…¨æ”¯æŒMCPå·¥å…·é›†æˆã€‚

---

#### 6. WebSocketå®æ—¶é€šä¿¡ âœ… **å·²éªŒè¯**

**éªŒè¯æ¥æº**: æŠ€æœ¯ç¤¾åŒºè®¨è®º + æœ€ä½³å®è·µ

**å…³é”®å‘ç°**:
- âœ… WebSocketæ˜¯æ ‡å‡†çš„å®æ—¶é€šä¿¡åè®®
- âœ… Node.jsçš„`ws`åº“æˆç†Ÿç¨³å®š
- âœ… æµè§ˆå™¨åŸç”Ÿæ”¯æŒWebSocket
- âœ… é€‚åˆå®æ—¶è¿›åº¦æ¨é€åœºæ™¯
- âœ… å¯ä»¥ä¸HTTPæœåŠ¡å…±å­˜

**å®ç°ç¤ºä¾‹**:
```typescript
// æœåŠ¡ç«¯
import { WebSocketServer } from 'ws';
const wss = new WebSocketServer({ port: 8080 });

wss.on('connection', (ws) => {
  ws.send(JSON.stringify({ type: 'progress', message: 'å¤„ç†ä¸­...' }));
});

// å®¢æˆ·ç«¯
const ws = new WebSocket('ws://localhost:8080');
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('è¿›åº¦æ›´æ–°:', data.message);
};
```

**ç»“è®º**: WebSocketæ˜¯å®æ—¶é€šä¿¡çš„æ ‡å‡†æ–¹æ¡ˆ,å®Œå…¨æ»¡è¶³è¿›åº¦æ¨é€éœ€æ±‚ã€‚

---

#### 7. FastMCPé«˜çº§ç‰¹æ€§ âœ… **å·²éªŒè¯**

**éªŒè¯æ¥æº**: FastMCPå®˜æ–¹æ–‡æ¡£å’ŒGitHubä»“åº“

**å…³é”®å‘ç°**:
- âœ… FastMCP 2.0æ”¯æŒå¤šç§ä¼ è¾“æ–¹å¼(stdio, HTTP, SSE)
- âœ… å†…ç½®ä¼ä¸šçº§è®¤è¯(OAuth, Google, GitHub, Azureç­‰)
- âœ… æ”¯æŒæœåŠ¡å™¨ç»„åˆ(mount/import_server)
- âœ… æ”¯æŒä»£ç†æ¨¡å¼(as_proxy)
- âœ… å¯ä»¥ä»OpenAPI/FastAPIè‡ªåŠ¨ç”ŸæˆMCPæœåŠ¡å™¨
- âœ… 20.2k GitHub stars,ç”Ÿäº§ç¯å¢ƒéªŒè¯

**é«˜çº§åŠŸèƒ½ç¤ºä¾‹**:
```python
# 1. HTTPä¼ è¾“(ç”¨äºè¿œç¨‹éƒ¨ç½²)
mcp.run(transport="http", host="0.0.0.0", port=8000)

# 2. ä¼ä¸šè®¤è¯
from fastmcp.server.auth.providers.google import GoogleProvider
auth = GoogleProvider(client_id="...", client_secret="...")
mcp = FastMCP("Protected Server", auth=auth)

# 3. æœåŠ¡å™¨ç»„åˆ
parent_mcp = FastMCP("Parent")
parent_mcp.mount(child_mcp, prefix="child")
```

**ç»“è®º**: FastMCPåŠŸèƒ½å¼ºå¤§,æ”¯æŒä»å¼€å‘åˆ°ç”Ÿäº§çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚

---

### æ½œåœ¨é£é™©è¯„ä¼°

#### ğŸŸ¡ ä¸­ç­‰é£é™©

1. **å¤§æ–‡æ¡£æ€§èƒ½**
   - **é£é™©**: å¤§äº10MBçš„æ–‡æ¡£åŒæ­¥å¯èƒ½è¾ƒæ…¢
   - **ç¼“è§£**: å®ç°å¢é‡åŒæ­¥,åˆ†ç‰‡ä¼ è¾“
   - **å½±å“**: å¯æ§,æœ‰æˆç†Ÿè§£å†³æ–¹æ¡ˆ

2. **è·¨å¹³å°å…¼å®¹æ€§**
   - **é£é™©**: ä¸åŒOfficeç‰ˆæœ¬APIå¯èƒ½æœ‰å·®å¼‚
   - **ç¼“è§£**: ä½¿ç”¨Office.jsæœ€æ–°ç‰ˆæœ¬,åšå¥½å…¼å®¹æ€§æµ‹è¯•
   - **å½±å“**: ä½,Office.jså‘åå…¼å®¹æ€§å¥½

#### ğŸŸ¢ ä½é£é™©

1. **MCPæœåŠ¡ç¨³å®šæ€§**
   - **é£é™©**: Pythonè¿›ç¨‹å¯èƒ½å´©æºƒ
   - **ç¼“è§£**: å®ç°è¿›ç¨‹ç›‘æ§å’Œè‡ªåŠ¨é‡å¯
   - **å½±å“**: å¾ˆä½,æœ‰æˆç†Ÿçš„è¿›ç¨‹ç®¡ç†æ–¹æ¡ˆ

2. **LLM APIé™åˆ¶**
   - **é£é™©**: APIè°ƒç”¨é¢‘ç‡é™åˆ¶
   - **ç¼“è§£**: å®ç°è¯·æ±‚é˜Ÿåˆ—å’Œé‡è¯•æœºåˆ¶
   - **å½±å“**: å¾ˆä½,å¯ä»¥é€šè¿‡é…ç½®è§£å†³

---

### æŠ€æœ¯é€‰å‹ç¡®è®¤

åŸºäºéªŒè¯ç»“æœ,ç¡®è®¤ä»¥ä¸‹æŠ€æœ¯é€‰å‹:

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | éªŒè¯çŠ¶æ€ | é£é™©ç­‰çº§ |
|------|---------|---------|---------|
| **å‰ç«¯æ¡†æ¶** | React + TypeScript | âœ… å·²éªŒè¯ | ğŸŸ¢ ä½ |
| **Office API** | Office.js | âœ… å·²éªŒè¯ | ğŸŸ¢ ä½ |
| **Bridge Server** | Node.js + Express | âœ… å·²éªŒè¯ | ğŸŸ¢ ä½ |
| **MCPæ¡†æ¶** | FastMCP 2.0 | âœ… å·²éªŒè¯ | ğŸŸ¢ ä½ |
| **è¿›ç¨‹é€šä¿¡** | child_process + stdio | âœ… å·²éªŒè¯ | ğŸŸ¢ ä½ |
| **LLMé›†æˆ** | OpenAI/Claude API | âœ… å·²éªŒè¯ | ğŸŸ¢ ä½ |
| **å®æ—¶é€šä¿¡** | WebSocket (ws) | âœ… å·²éªŒè¯ | ğŸŸ¢ ä½ |
| **è®¤è¯** | FastMCP Auth | âœ… å·²éªŒè¯ | ğŸŸ¢ ä½ |

---

### æœ€ç»ˆç»“è®º

âœ… **æŠ€æœ¯æ–¹æ¡ˆå®Œå…¨å¯è¡Œ,å¯ä»¥ç«‹å³å¼€å§‹å®æ–½**

**ç†ç”±**:
1. âœ… æ‰€æœ‰æ ¸å¿ƒæŠ€æœ¯éƒ½æ˜¯æˆç†Ÿçš„ã€ç»è¿‡ç”Ÿäº§éªŒè¯çš„æ ‡å‡†æŠ€æœ¯
2. âœ… å®˜æ–¹æ–‡æ¡£å®Œå–„,ç¤¾åŒºæ”¯æŒè‰¯å¥½
3. âœ… å·²æœ‰å¤§é‡æˆåŠŸæ¡ˆä¾‹å¯ä»¥å‚è€ƒ
4. âœ… é£é™©å¯æ§,æœ‰æ˜ç¡®çš„ç¼“è§£æªæ–½
5. âœ… æŠ€æœ¯æ ˆç»Ÿä¸€(TypeScript/JavaScript + Python),å›¢é˜Ÿå®¹æ˜“ä¸Šæ‰‹

**å»ºè®®**:
1. æŒ‰ç…§æ–‡æ¡£ä¸­çš„5ä¸ªé˜¶æ®µé€æ­¥å®æ–½
2. å…ˆå®ŒæˆåŸºç¡€æ¶æ„éªŒè¯(é˜¶æ®µ1-2)
3. å†è¿›è¡ŒAIé›†æˆå’ŒåŠŸèƒ½å®Œå–„(é˜¶æ®µ3-4)
4. æœ€åè¿›è¡Œå…¨é¢æµ‹è¯•å’Œéƒ¨ç½²(é˜¶æ®µ5)

**é¢„æœŸæ—¶é—´**: 10å‘¨(2.5ä¸ªæœˆ)

**æˆåŠŸæ¦‚ç‡**: 95%ä»¥ä¸Š

---

**æ–‡æ¡£ç»“æŸ**

