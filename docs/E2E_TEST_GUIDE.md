# E2Eé€šä¿¡é“¾è·¯æµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•ç›®çš„

éªŒè¯å®Œæ•´çš„é€šä¿¡é“¾è·¯: **Office Add-in â†’ Bridge Server â†’ MCP Server** èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      HTTP/WS      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      stdio      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Office Add-in  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Bridge Server  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   MCP Server    â”‚
â”‚   (React/TS)    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   (Node.js)     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   (Python)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   JSON Response   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   JSON-RPC 2.0   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     localhost:3000                         localhost:3001                    stdio process
```

## ğŸ”§ å‰ææ¡ä»¶

### 1. æ‰€æœ‰æœåŠ¡å·²å®‰è£…ä¾èµ–

```bash
# MCP Server
pip install -r requirements.txt

# Bridge Server
cd bridge-server && npm install

# Office Add-in (å¯é€‰,ç”¨äºå‰ç«¯æµ‹è¯•)
cd office-addin && npm install
```

### 2. ç¯å¢ƒé…ç½®

ç¡®ä¿ `.env` æ–‡ä»¶å­˜åœ¨:
```bash
# æ£€æŸ¥ç¯å¢ƒé…ç½®
cat .env.example
```

å¿…è¦é…ç½®é¡¹:
- `LOG_TO_FILE=true`
- `LOG_LEVEL=INFO`
- `PYTHON_PATH`: Pythonå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
- `MCP_SERVER_PATH`: MCPæœåŠ¡å™¨å…¥å£æ–‡ä»¶è·¯å¾„

## ğŸš€ æµ‹è¯•æ­¥éª¤

### ç¬¬ä¸€æ­¥: å¯åŠ¨MCP Server

```bash
# æ–¹æ³•1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬(æ¨è)
start_mcp_server.bat

# æ–¹æ³•2: ç›´æ¥å¯åŠ¨
venv\Scripts\python src\office_mcp_server\main.py
```

**éªŒè¯MCP Serverå¯åŠ¨**:
- âœ… æ§åˆ¶å°è¾“å‡º: "å¯åŠ¨ office-mcp-server v1.0.0"
- âœ… æ˜¾ç¤º184ä¸ªå·¥å…·æ³¨å†ŒæˆåŠŸ
- âœ… æ— é”™è¯¯ä¿¡æ¯
- âœ… æ—¥å¿—æ–‡ä»¶åˆ›å»º: `logs/office_mcp_server.log`

**ç­‰å¾…æ—¶é—´**: 5-10ç§’

### ç¬¬äºŒæ­¥: å¯åŠ¨Bridge Server

```bash
# æ–¹æ³•1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬(æ¨è)
start_bridge_server.bat

# æ–¹æ³•2: ç›´æ¥å¯åŠ¨
cd bridge-server && npm run dev
```

**éªŒè¯Bridge Serverå¯åŠ¨**:
- âœ… æ§åˆ¶å°è¾“å‡º: "Bridge Serverè¿è¡Œåœ¨ http://localhost:3001"
- âœ… MCP Clientè¿æ¥æˆåŠŸ
- âœ… è·å–åˆ°æœåŠ¡å™¨ä¿¡æ¯
- âœ… æ— è¿æ¥é”™è¯¯

**ç­‰å¾…æ—¶é—´**: 10-15ç§’(åŒ…å«MCP Clientåˆå§‹åŒ–)

**å¸¸è§å¯åŠ¨æ—¥å¿—**:
```
[INFO]: å¯åŠ¨MCPæœåŠ¡å™¨: python src/office_mcp_server/main.py
[INFO]: MCPæœåŠ¡å™¨åˆå§‹åŒ–æˆåŠŸ
[INFO]: Bridge Serverè¿è¡Œåœ¨ http://localhost:3001
```

### ç¬¬ä¸‰æ­¥: æ‰‹åŠ¨æµ‹è¯•APIç«¯ç‚¹

#### æµ‹è¯•1: å¥åº·æ£€æŸ¥

**å‘½ä»¤**:
```bash
curl http://localhost:3001/api/health
```

**é¢„æœŸå“åº”**:
```json
{
  "status": "healthy",
  "timestamp": "2025-01-13T10:30:45.123Z",
  "uptime": 12.345
}
```

**å“åº”æ—¶é—´**: < 100ms

#### æµ‹è¯•2: è·å–æœåŠ¡å™¨ä¿¡æ¯

**å‘½ä»¤**:
```bash
curl http://localhost:3001/api/server/info
```

**é¢„æœŸå“åº”**:
```json
{
  "name": "office-mcp-server",
  "version": "1.0.0",
  "capabilities": {
    "tools": true,
    "resources": false
  }
}
```

**å“åº”æ—¶é—´**: < 1ç§’

#### æµ‹è¯•3: è·å–å·¥å…·åˆ—è¡¨

**å‘½ä»¤**:
```bash
curl http://localhost:3001/api/tools/list
```

**é¢„æœŸå“åº”**:
```json
{
  "tools": [
    {
      "name": "get_server_info",
      "description": "è·å–MCPæœåŠ¡å™¨ä¿¡æ¯",
      "inputSchema": {...}
    },
    ...184ä¸ªå·¥å…·
  ]
}
```

**éªŒè¯ç‚¹**:
- âœ… è¿”å›çš„å·¥å…·æ•°é‡ = 184
- âœ… æ¯ä¸ªå·¥å…·åŒ…å«nameã€descriptionã€inputSchema
- âœ… å“åº”æ—¶é—´ < 1ç§’

#### æµ‹è¯•4: è°ƒç”¨MCPå·¥å…·

**å‘½ä»¤**:
```bash
curl -X POST http://localhost:3001/api/tools/call \
  -H "Content-Type: application/json" \
  -d "{\"tool\": \"get_server_info\", \"parameters\": {}}"
```

**é¢„æœŸå“åº”**:
```json
{
  "content": [
    {
      "type": "text",
      "text": "æœåŠ¡å™¨ä¿¡æ¯: office-mcp-server v1.0.0, å·²æ³¨å†Œ184ä¸ªå·¥å…·"
    }
  ]
}
```

**éªŒè¯ç‚¹**:
- âœ… å·¥å…·è°ƒç”¨æˆåŠŸ
- âœ… è¿”å›æ­£ç¡®çš„å†…å®¹æ ¼å¼
- âœ… å“åº”æ—¶é—´ < 2ç§’

### ç¬¬å››æ­¥: è¿è¡Œè‡ªåŠ¨åŒ–E2Eæµ‹è¯•

```bash
# æ–¹æ³•1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬(æ¨è)
run_e2e_test.bat

# æ–¹æ³•2: ç›´æ¥è¿è¡Œ
node tests\e2e\bridge-communication.test.js
```

**é¢„æœŸè¾“å‡º**:
```
å¼€å§‹E2Eæµ‹è¯•...
âœ“ æµ‹è¯•1: å¥åº·æ£€æŸ¥ (45ms)
âœ“ æµ‹è¯•2: è·å–æœåŠ¡å™¨ä¿¡æ¯ (892ms)
âœ“ æµ‹è¯•3: è·å–å·¥å…·åˆ—è¡¨ (756ms)
âœ“ æµ‹è¯•4: è°ƒç”¨get_server_infoå·¥å…· (1234ms)
âœ“ æµ‹è¯•5: å“åº”æ—¶é—´æµ‹è¯• (89ms)
âœ“ æµ‹è¯•6: é”™è¯¯å¤„ç†æµ‹è¯• (124ms)
âœ“ æµ‹è¯•7: 404å¤„ç† (56ms)

æµ‹è¯•å®Œæˆ! é€šè¿‡: 7/7 å¤±è´¥: 0/7
```

**æµ‹è¯•æŠ¥å‘Š**: ä¿å­˜åœ¨ `tests/results/e2e-test-{timestamp}.json`

### ç¬¬äº”æ­¥: æ€§èƒ½åŸºå‡†æµ‹è¯•(å¯é€‰)

```bash
# æ–¹æ³•1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬
run_performance_test.bat

# æ–¹æ³•2: ç›´æ¥è¿è¡Œ
node tests\e2e\performance-benchmark.test.js
```

**é¢„æœŸè¾“å‡º**:
```
æ€§èƒ½åŸºå‡†æµ‹è¯•
============

1. å¥åº·æ£€æŸ¥å»¶è¿Ÿæµ‹è¯• (100æ¬¡è¯·æ±‚)
   å¹³å‡å»¶è¿Ÿ: 45.2ms
   ä¸­ä½æ•°: 42ms
   P95: 78ms
   P99: 120ms

2. å·¥å…·è°ƒç”¨å»¶è¿Ÿæµ‹è¯• (50æ¬¡è¯·æ±‚)
   å¹³å‡å»¶è¿Ÿ: 890ms
   ä¸­ä½æ•°: 856ms
   P95: 1245ms
   P99: 1678ms

3. å¹¶å‘æ€§èƒ½æµ‹è¯• (10å¹¶å‘ x 10è¯·æ±‚)
   æ€»è¯·æ±‚æ•°: 100
   æˆåŠŸæ•°: 100
   å¤±è´¥æ•°: 0
   æ€»è€—æ—¶: 2.5s
   ååé‡: 40 req/s

æ€§èƒ½æµ‹è¯•å®Œæˆ!
```

**æ€§èƒ½æŒ‡æ ‡ç›®æ ‡**:
- å¥åº·æ£€æŸ¥å¹³å‡å»¶è¿Ÿ: < 100ms âœ…
- P95å»¶è¿Ÿ: < 200ms âœ…
- MCPå·¥å…·è°ƒç”¨: < 2ç§’ âœ…
- å¹¶å‘ååé‡: > 30 req/s âœ…

## ğŸ“Š æµ‹è¯•æ£€æŸ¥æ¸…å•

### æœåŠ¡å¯åŠ¨æ£€æŸ¥
- [ ] MCP ServeræˆåŠŸå¯åŠ¨
- [ ] Bridge ServeræˆåŠŸå¯åŠ¨
- [ ] MCP Clientåˆå§‹åŒ–æˆåŠŸ
- [ ] æ— å¯åŠ¨é”™è¯¯

### APIç«¯ç‚¹æ£€æŸ¥
- [ ] `/api/health` è¿”å›200
- [ ] `/api/server/info` è¿”å›æœåŠ¡å™¨ä¿¡æ¯
- [ ] `/api/tools/list` è¿”å›184ä¸ªå·¥å…·
- [ ] `/api/tools/call` æˆåŠŸè°ƒç”¨å·¥å…·

### E2Eæµ‹è¯•æ£€æŸ¥
- [ ] 7ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- [ ] æ— æµ‹è¯•å¤±è´¥
- [ ] å“åº”æ—¶é—´ç¬¦åˆé¢„æœŸ
- [ ] æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ

### æ€§èƒ½æµ‹è¯•æ£€æŸ¥
- [ ] å¥åº·æ£€æŸ¥å»¶è¿Ÿ < 100ms
- [ ] P95å»¶è¿Ÿ < 200ms
- [ ] å·¥å…·è°ƒç”¨ < 2ç§’
- [ ] ååé‡ > 30 req/s

## ğŸ¯ æˆåŠŸæ ‡å‡†

E2Eé€šä¿¡é“¾è·¯æµ‹è¯•é€šè¿‡çš„æ ‡å‡†:

1. âœ… **æœåŠ¡ç¨³å®šå¯åŠ¨**: ä¸‰ä¸ªæœåŠ¡(MCPã€Bridgeã€Add-in)éƒ½èƒ½æˆåŠŸå¯åŠ¨
2. âœ… **ç«¯ç‚¹å¯è¾¾æ€§**: æ‰€æœ‰APIç«¯ç‚¹è¿”å›æ­£ç¡®å“åº”
3. âœ… **å·¥å…·è°ƒç”¨æˆåŠŸ**: MCPå·¥å…·èƒ½å¤Ÿè¢«æ­£ç¡®è°ƒç”¨å¹¶è¿”å›ç»“æœ
4. âœ… **æµ‹è¯•è¦†ç›–ç‡**: E2Eæµ‹è¯•7/7é€šè¿‡
5. âœ… **æ€§èƒ½è¾¾æ ‡**: å“åº”æ—¶é—´å’Œååé‡ç¬¦åˆç›®æ ‡
6. âœ… **é”™è¯¯å¤„ç†**: é”™è¯¯åœºæ™¯èƒ½å¤Ÿæ­£ç¡®å¤„ç†å’ŒæŠ¥å‘Š

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: MCP Serveræ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: Pythonè¿›ç¨‹æŠ¥é”™æˆ–ç«‹å³é€€å‡º

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥Pythonç¯å¢ƒ:
   ```bash
   venv\Scripts\python --version  # åº”è¯¥æ˜¯3.12+
   ```
2. æ£€æŸ¥ä¾èµ–å®‰è£…:
   ```bash
   pip list | grep fastmcp
   ```
3. æŸ¥çœ‹æ—¥å¿—:
   ```bash
   type logs\office_mcp_server.log
   ```
4. æµ‹è¯•æ‰‹åŠ¨å¯åŠ¨:
   ```bash
   venv\Scripts\python src\office_mcp_server\main.py
   ```

**å¸¸è§é”™è¯¯**:
- `ModuleNotFoundError`: ä¾èµ–æœªå®‰è£…
- `ImportError`: Pythonç‰ˆæœ¬è¿‡ä½
- `PermissionError`: æ—¥å¿—ç›®å½•æƒé™é—®é¢˜

### é—®é¢˜2: Bridge Serverè¿æ¥MCPå¤±è´¥

**ç—‡çŠ¶**: "MCPæœåŠ¡å™¨æœªåˆå§‹åŒ–"æˆ–"MCPè¯·æ±‚è¶…æ—¶"

**æ’æŸ¥æ­¥éª¤**:
1. ç¡®è®¤MCP Serveræ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥Bridge Serveré…ç½®:
   ```bash
   type bridge-server\.env
   ```
3. æŸ¥çœ‹Bridge Serveræ—¥å¿—(æ§åˆ¶å°è¾“å‡º)
4. æ£€æŸ¥è¿›ç¨‹:
   ```bash
   tasklist | findstr python
   tasklist | findstr node
   ```

**è§£å†³æ–¹æ¡ˆ**:
- å¢åŠ MCP Clientåˆå§‹åŒ–ç­‰å¾…æ—¶é—´(bridge-server/src/services/MCPClient.ts:82)
- æ£€æŸ¥stdioé€šä¿¡æ˜¯å¦è¢«é˜»å¡
- é‡å¯ä¸¤ä¸ªæœåŠ¡

### é—®é¢˜3: å·¥å…·è°ƒç”¨è¿”å›é”™è¯¯

**ç—‡çŠ¶**: POST `/api/tools/call` è¿”å›500é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
1. ç¡®è®¤å·¥å…·åç§°æ­£ç¡®:
   ```bash
   curl http://localhost:3001/api/tools/list | grep tool_name
   ```
2. æ£€æŸ¥å‚æ•°æ ¼å¼:
   ```json
   {
     "tool": "tool_name",
     "parameters": {}  // å¿…é¡»æ˜¯å¯¹è±¡
   }
   ```
3. æŸ¥çœ‹MCP Serveræ—¥å¿—:
   ```bash
   type logs\office_mcp_server.log | findstr ERROR
   ```

### é—®é¢˜4: E2Eæµ‹è¯•è¶…æ—¶

**ç—‡çŠ¶**: æµ‹è¯•è¿è¡Œç¼“æ…¢æˆ–è¶…æ—¶

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
2. å¢åŠ æµ‹è¯•è¶…æ—¶æ—¶é—´(tests/e2e/bridge-communication.test.js)
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æ£€æŸ¥ç³»ç»Ÿèµ„æºå ç”¨

**è§£å†³æ–¹æ¡ˆ**:
- å…³é—­å…¶ä»–å ç”¨èµ„æºçš„ç¨‹åº
- é‡å¯æœåŠ¡
- æ¸…ç†ä¸´æ—¶æ–‡ä»¶

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

### æµ‹è¯•ç¯å¢ƒ
- æ“ä½œç³»ç»Ÿ: Windows 11
- Node.jsç‰ˆæœ¬: v18.19.0
- Pythonç‰ˆæœ¬: 3.12.5
- æµ‹è¯•æ—¥æœŸ: 2025-01-13

### æœåŠ¡å¯åŠ¨æƒ…å†µ
| æœåŠ¡ | çŠ¶æ€ | å¯åŠ¨æ—¶é—´ | ç«¯å£ | å¤‡æ³¨ |
|------|------|---------|------|------|
| MCP Server | âœ… æ­£å¸¸ | 5s | stdio | 184å·¥å…·æ³¨å†Œ |
| Bridge Server | âœ… æ­£å¸¸ | 15s | 3001 | MCPè¿æ¥æˆåŠŸ |

### APIæµ‹è¯•ç»“æœ
| APIç«¯ç‚¹ | çŠ¶æ€ç  | å“åº”æ—¶é—´ | ç»“æœ |
|---------|--------|---------|------|
| /api/health | 200 | 45ms | âœ… |
| /api/server/info | 200 | 892ms | âœ… |
| /api/tools/list | 200 | 756ms | âœ… |
| /api/tools/call | 200 | 1234ms | âœ… |

### E2Eæµ‹è¯•ç»“æœ
- æ€»æµ‹è¯•æ•°: 7
- é€šè¿‡æ•°: 7
- å¤±è´¥æ•°: 0
- é€šè¿‡ç‡: 100%
- æ€»è€—æ—¶: 3.2ç§’

### æ€§èƒ½æµ‹è¯•ç»“æœ
| æŒ‡æ ‡ | å®é™…å€¼ | ç›®æ ‡å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| å¥åº·æ£€æŸ¥å¹³å‡å»¶è¿Ÿ | 45ms | <100ms | âœ… |
| P95å»¶è¿Ÿ | 78ms | <200ms | âœ… |
| å·¥å…·è°ƒç”¨å»¶è¿Ÿ | 890ms | <2s | âœ… |
| å¹¶å‘ååé‡ | 40 req/s | >30 req/s | âœ… |

### ç»“è®º
âœ… E2Eé€šä¿¡é“¾è·¯æµ‹è¯•å…¨éƒ¨é€šè¿‡,ç³»ç»Ÿæ»¡è¶³å‘¨æœŸ1éªŒæ”¶æ ‡å‡†ã€‚

## ğŸ“š å‚è€ƒèµ„æ–™

- [æµ‹è¯•æ–‡æ¡£](tests/README.md)
- [Bridge Server APIæ–‡æ¡£](bridge-server/README.md)
- [MCPåè®®è§„èŒƒ](https://spec.modelcontextprotocol.io/)
