# 配置页面详细设计文档

## 概述

本文档详细描述桌面应用各配置页面的 UI 设计、交互逻辑和数据结构。

---

## 1. AI 服务配置页面

### 1.1 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  AI 服务配置                                    [+ 添加提供商]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ★ OpenAI                              [默认] [编辑] [删除]│   │
│  │ 状态: ● 已连接                                           │   │
│  │ 端点: https://api.openai.com/v1                         │   │
│  │ 模型数: 5                                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Azure OpenAI                                [编辑] [删除]│   │
│  │ 状态: ○ 未测试                                          │   │
│  │ 端点: https://xxx.openai.azure.com                      │   │
│  │ 模型数: 2                                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Ollama (本地)                              [编辑] [删除] │   │
│  │ 状态: ● 运行中                                          │   │
│  │ 端点: http://localhost:11434                            │   │
│  │ 模型数: 3                                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 添加/编辑提供商弹窗

```
┌─────────────────────────────────────────────────────────────────┐
│  添加 AI 提供商                                          [×]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  提供商类型                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ○ OpenAI   ○ Azure   ○ Anthropic   ○ Ollama   ○ 自定义  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  名称 *                                                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 我的 OpenAI                                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  API Key *                                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ sk-••••••••••••••••••••••••                        [👁]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Base URL (可选)                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ https://api.openai.com/v1                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ─────────────── Azure 特有配置 ───────────────                 │
│                                                                 │
│  部署名称 *                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ gpt-4-deployment                                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  API 版本                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 2024-02-15-preview                              [▼]     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  □ 启用此提供商                                                 │
│  □ 设为默认提供商                                               │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                    [测试连接]        [取消]  [保存]             │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 数据结构

```typescript
// AI 提供商类型
type AIProviderType = 'openai' | 'azure' | 'anthropic' | 'ollama' | 'custom'

// 提供商配置
interface AIProviderConfig {
  id: string
  type: AIProviderType
  name: string
  enabled: boolean
  isDefault: boolean

  // 认证
  apiKey: string
  baseUrl?: string

  // Azure 特有
  azureEndpoint?: string
  azureDeployment?: string
  azureApiVersion?: string

  // 自定义端点
  customHeaders?: Record<string, string>

  // 状态
  connectionStatus?: 'connected' | 'disconnected' | 'unknown'
  lastTestedAt?: number
}

// 连接测试结果
interface ConnectionTestResult {
  success: boolean
  latency?: number
  error?: string
  availableModels?: string[]
}
```

### 1.4 交互逻辑

| 操作 | 行为 |
|------|------|
| 点击"添加提供商" | 打开添加弹窗 |
| 选择提供商类型 | 显示对应的配置表单 |
| 点击"测试连接" | 发送测试请求，显示结果 |
| 点击"保存" | 验证表单，保存配置 |
| 点击"设为默认" | 更新默认提供商 |
| 点击"删除" | 确认后删除（检查是否有模型依赖） |

---

## 2. 模型管理页面

### 2.1 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  模型管理                                        [+ 添加模型]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  筛选: [所有提供商 ▼]  [所有状态 ▼]          🔍 搜索模型       │
│                                                                 │
│  ─────────────────── OpenAI ───────────────────                │
│                                                                 │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐  │
│  │ GPT-4o     │ │ GPT-4      │ │ GPT-3.5    │ │ + 添加     │  │
│  │ ★ 默认    │ │            │ │ Turbo      │ │            │  │
│  │ ● 可用    │ │ ● 可用    │ │ ● 可用    │ │            │  │
│  │ [配置]    │ │ [配置]    │ │ [配置]    │ │            │  │
│  └────────────┘ └────────────┘ └────────────┘ └────────────┘  │
│                                                                 │
│  ─────────────────── Ollama ───────────────────                │
│                                                                 │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐                  │
│  │ Llama3     │ │ Qwen2      │ │ CodeLlama  │                  │
│  │            │ │            │ │            │                  │
│  │ ● 本地    │ │ ● 本地    │ │ ○ 未下载  │                  │
│  │ [配置]    │ │ [配置]    │ │ [下载]    │                  │
│  └────────────┘ └────────────┘ └────────────┘                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 模型配置弹窗

```
┌─────────────────────────────────────────────────────────────────┐
│  模型配置 - GPT-4o                                       [×]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  基本信息                                                       │
│  ├─ 提供商: OpenAI                                             │
│  ├─ 模型 ID: gpt-4o                                            │
│  └─ 显示名称: ┌──────────────────────────────────────────┐     │
│               │ GPT-4o (最新)                             │     │
│               └──────────────────────────────────────────┘     │
│                                                                 │
│  ─────────────────── 参数配置 ───────────────────              │
│                                                                 │
│  最大 Tokens                                                    │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ ○───────────────────────────────●────────────────────○ │    │
│  │ 1000                        4096                 128000│    │
│  └────────────────────────────────────────────────────────┘    │
│  当前值: 4096                                                   │
│                                                                 │
│  Temperature (创造性)                                           │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ ○─────●────────────────────────────────────────────────○ │    │
│  │ 0    0.7                                              2 │    │
│  └────────────────────────────────────────────────────────┘    │
│  当前值: 0.7  (推荐: 0.7)                                       │
│                                                                 │
│  Top P                                                          │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ ○────────────────────────────────────────────────●────○ │    │
│  │ 0                                                    1 │    │
│  └────────────────────────────────────────────────────────┘    │
│  当前值: 0.95                                                   │
│                                                                 │
│  ─────────────────── 功能支持 ───────────────────              │
│                                                                 │
│  ☑ 支持视觉 (图片输入)                                         │
│  ☑ 支持工具调用 (Function Calling)                             │
│  ☑ 支持流式输出                                                │
│                                                                 │
│  □ 启用此模型                                                   │
│  □ 设为默认模型                                                 │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                    [恢复默认]        [取消]  [保存]             │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 数据结构

```typescript
interface ModelConfig {
  id: string
  providerId: string
  name: string           // 模型 ID (如 gpt-4o)
  displayName: string    // 显示名称
  enabled: boolean
  isDefault: boolean

  // 参数配置
  maxTokens: number
  temperature: number
  topP: number
  frequencyPenalty: number
  presencePenalty: number

  // 功能支持
  supportsVision: boolean
  supportsTools: boolean
  supportsStreaming: boolean

  // 上下文窗口
  contextWindow: number

  // 定价信息 (可选)
  pricing?: {
    input: number   // 每百万 token
    output: number
  }
}

// 预设模型模板
const PRESET_MODELS: Record<AIProviderType, ModelConfig[]> = {
  openai: [
    { name: 'gpt-4o', displayName: 'GPT-4o', contextWindow: 128000, ... },
    { name: 'gpt-4-turbo', displayName: 'GPT-4 Turbo', ... },
    { name: 'gpt-3.5-turbo', displayName: 'GPT-3.5 Turbo', ... },
  ],
  anthropic: [
    { name: 'claude-3-opus', displayName: 'Claude 3 Opus', ... },
    { name: 'claude-3-sonnet', displayName: 'Claude 3 Sonnet', ... },
  ],
  // ...
}
```

---

## 3. 联网搜索配置页面

### 3.1 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  联网搜索配置                                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  启用联网搜索  ┌──────────────────────────────────────────┐    │
│                │         ○──────────────●                 │    │
│                └──────────────────────────────────────────┘    │
│                已启用                                           │
│                                                                 │
│  ─────────────────── 搜索引擎 ───────────────────              │
│                                                                 │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ ● Tavily (推荐)                                        │    │
│  │   AI 优化搜索引擎，结果质量高                          │    │
│  ├────────────────────────────────────────────────────────┤    │
│  │ ○ Serper                                               │    │
│  │   Google 搜索 API，覆盖面广                            │    │
│  ├────────────────────────────────────────────────────────┤    │
│  │ ○ Bing Search                                          │    │
│  │   微软搜索，支持中文                                   │    │
│  ├────────────────────────────────────────────────────────┤    │
│  │ ○ DuckDuckGo                                           │    │
│  │   免费、无需 API Key                                   │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ─────────────────── API 配置 ───────────────────              │
│                                                                 │
│  API Key *                                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ tvly-••••••••••••••••••••••••                      [👁]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│  获取 API Key: https://tavily.com                               │
│                                                                 │
│  ─────────────────── 搜索参数 ───────────────────              │
│                                                                 │
│  最大结果数                                                     │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ ○────────●─────────────────────────────────────────────○ │    │
│  │ 3       5                                            10 │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  搜索深度                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ● 基础 (快速)        ○ 深度 (详细)                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  □ 包含图片结果                                                 │
│                                                                 │
│  ─────────────────── 域名过滤 ───────────────────              │
│                                                                 │
│  仅搜索以下域名 (留空则不限制)                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ wikipedia.org, github.com, stackoverflow.com            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  排除以下域名                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ pinterest.com, quora.com                                │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ─────────────────── 测试搜索 ───────────────────              │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 什么是 MCP 协议                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│  [测试搜索]                                                     │
│                                                                 │
│  搜索结果:                                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. Model Context Protocol 介绍 - Anthropic              │   │
│  │    https://anthropic.com/mcp                            │   │
│  │    MCP 是一个开放协议，用于连接 AI 模型和工具...        │   │
│  │                                                         │   │
│  │ 2. MCP 协议规范 - GitHub                                │   │
│  │    https://github.com/modelcontextprotocol/spec         │   │
│  │    官方协议规范文档...                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                              [重置]  [保存]     │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 数据结构

```typescript
type SearchProvider = 'tavily' | 'serper' | 'bing' | 'google' | 'duckduckgo'

interface WebSearchConfig {
  enabled: boolean
  provider: SearchProvider
  apiKey: string

  // 搜索参数
  maxResults: number
  searchDepth: 'basic' | 'advanced'
  includeImages: boolean

  // 域名过滤
  includeDomains: string[]
  excludeDomains: string[]

  // 区域设置
  region?: string
  language?: string
}

interface SearchResult {
  title: string
  url: string
  snippet: string
  score?: number
  publishedDate?: string
}

// 搜索引擎信息
const SEARCH_PROVIDERS: Record<SearchProvider, {
  name: string
  description: string
  requiresApiKey: boolean
  getApiKeyUrl?: string
  features: string[]
}> = {
  tavily: {
    name: 'Tavily',
    description: 'AI 优化搜索引擎，结果质量高',
    requiresApiKey: true,
    getApiKeyUrl: 'https://tavily.com',
    features: ['AI 优化', '结果评分', '内容摘要']
  },
  // ...
}
```

---

## 4. MCP 配置页面

### 4.1 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  MCP 服务器配置                              [+ 添加服务器]     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Word MCP Server                                         │   │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │   │
│  │ 状态: ● 运行中   PID: 12345   启动时间: 10:30:45        │   │
│  │ 工具数: 15                                              │   │
│  │                                                         │   │
│  │ [查看工具]  [查看日志]  [停止]  [重启]  [配置]  [删除]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Excel MCP Server                                        │   │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │   │
│  │ 状态: ● 运行中   PID: 12346   启动时间: 10:30:46        │   │
│  │ 工具数: 20                                              │   │
│  │                                                         │   │
│  │ [查看工具]  [查看日志]  [停止]  [重启]  [配置]  [删除]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ PowerPoint MCP Server                                   │   │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │   │
│  │ 状态: ○ 已停止                                          │   │
│  │                                                         │   │
│  │ [启动]  [配置]  [删除]                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 自定义 MCP Server                                       │   │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │   │
│  │ 状态: ✕ 错误                                            │   │
│  │ 错误: ENOENT: no such file or directory                 │   │
│  │                                                         │   │
│  │ [查看日志]  [重试]  [配置]  [删除]                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ─────────────────── 操作 ───────────────────                  │
│                                                                 │
│  [全部启动]  [全部停止]  [刷新状态]                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 添加/编辑服务器弹窗

```
┌─────────────────────────────────────────────────────────────────┐
│  添加 MCP 服务器                                         [×]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  服务器名称 *                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 我的 MCP 服务器                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  启动命令 *                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ node                                               [▼]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│  常用: node, python, npx                                        │
│                                                                 │
│  命令参数                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ /path/to/server.js                              [浏览]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  工作目录                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ /path/to/project                                [浏览]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  环境变量                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ KEY              │ VALUE                         │ [×]  │   │
│  │ NODE_ENV         │ production                    │ [×]  │   │
│  │                  │                               │ [+]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  □ 启用此服务器                                                 │
│  □ 随应用启动自动运行                                           │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                              [取消]  [保存]     │
└─────────────────────────────────────────────────────────────────┘
```

### 4.3 工具列表弹窗

```
┌─────────────────────────────────────────────────────────────────┐
│  Word MCP Server - 工具列表 (15)                         [×]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  🔍 搜索工具                                                    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 📝 create_document                                      │   │
│  │    创建新的 Word 文档                                   │   │
│  │    参数: title (string), content? (string)              │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 📄 get_document_content                                 │   │
│  │    获取当前文档内容                                     │   │
│  │    参数: format? (text|html|markdown)                   │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ ✏️ insert_text                                          │   │
│  │    在指定位置插入文本                                   │   │
│  │    参数: text (string), position? (start|end|cursor)    │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 🔄 replace_text                                         │   │
│  │    替换文档中的文本                                     │   │
│  │    参数: search (string), replace (string), all? (bool) │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ ... 更多工具                                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                      [关闭]     │
└─────────────────────────────────────────────────────────────────┘
```

### 4.4 数据结构

```typescript
interface McpServerConfig {
  id: string
  name: string
  command: string
  args: string[]
  cwd?: string
  env: Record<string, string>
  enabled: boolean
  autoStart: boolean
}

interface McpServerStatus {
  id: string
  name: string
  status: 'running' | 'stopped' | 'error' | 'starting'
  pid?: number
  startTime?: number
  lastError?: string
  toolCount?: number
}

interface McpTool {
  name: string
  description: string
  inputSchema: {
    type: 'object'
    properties: Record<string, {
      type: string
      description?: string
      enum?: string[]
    }>
    required?: string[]
  }
}
```

---

## 5. 知识库管理页面

### 5.1 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  知识库管理                                    [+ 添加知识库]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 📚 项目文档                                             │   │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │   │
│  │ 来源: /Users/xxx/Documents/project-docs                 │   │
│  │ 文件类型: .md, .txt, .pdf                               │   │
│  │ 文档数: 156   向量数: 2,340                             │   │
│  │ 状态: ● 已索引   最后更新: 2024-01-15 10:30             │   │
│  │                                                         │   │
│  │ [搜索测试]  [重建索引]  [配置]  [删除]                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 📖 技术书籍                                             │   │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │   │
│  │ 来源: /Users/xxx/Books/tech                             │   │
│  │ 文件类型: .pdf, .epub                                   │   │
│  │ 文档数: 42   向量数: 15,680                             │   │
│  │ 状态: ⟳ 索引中... 65%                                   │   │
│  │ ┌────────────────────────────────────────────────────┐  │   │
│  │ │████████████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░│  │   │
│  │ └────────────────────────────────────────────────────┘  │   │
│  │                                                         │   │
│  │ [暂停]  [取消]                                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 📁 代码仓库                                             │   │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │   │
│  │ 来源: /Users/xxx/Projects/my-app                        │   │
│  │ 文件类型: .ts, .tsx, .js, .py                           │   │
│  │ 文档数: 0   向量数: 0                                   │   │
│  │ 状态: ○ 未索引                                          │   │
│  │                                                         │   │
│  │ [开始索引]  [配置]  [删除]                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ─────────────────── 向量存储配置 ───────────────────          │
│                                                                 │
│  存储方式: ● 本地 (SQLite + HNSW)   ○ Qdrant   ○ Pinecone      │
│  嵌入模型: text-embedding-3-small (OpenAI)                      │
│  [配置向量存储]                                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 添加知识库弹窗

```
┌─────────────────────────────────────────────────────────────────┐
│  添加知识库                                              [×]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  知识库名称 *                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 我的知识库                                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  描述                                                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 存放项目相关的技术文档                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  来源类型                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ● 本地文件夹        ○ Notion        ○ Confluence        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  文件夹路径 *                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ /Users/xxx/Documents/docs                       [浏览]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  文件类型 (勾选要索引的类型)                                    │
│                                                                 │
│  文档:    ☑ .pdf  ☑ .docx  ☑ .doc  ☑ .txt  ☑ .md              │
│  表格:    ☑ .xlsx  ☑ .xls  ☑ .csv                              │
│  代码:    □ .js  □ .ts  □ .py  □ .java  □ .go                  │
│  网页:    □ .html  □ .htm                                      │
│                                                                 │
│  排除模式 (glob)                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ **/node_modules/**, **/.git/**, **/dist/**              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ─────────────────── 索引设置 ───────────────────              │
│                                                                 │
│  分块大小: 1000 字符                                            │
│  重叠大小: 200 字符                                             │
│  □ 立即开始索引                                                 │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                              [取消]  [创建]     │
└─────────────────────────────────────────────────────────────────┘
```

### 5.3 搜索测试弹窗

```
┌─────────────────────────────────────────────────────────────────┐
│  知识库搜索测试 - 项目文档                               [×]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  搜索查询                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 如何配置 API 端点                                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│  [搜索]                                                         │
│                                                                 │
│  返回结果数: 5    相似度阈值: 0.7                               │
│                                                                 │
│  ─────────────────── 搜索结果 ───────────────────              │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 📄 api-guide.md                        相似度: 0.92     │   │
│  │ ─────────────────────────────────────────────────────── │   │
│  │ ## API 端点配置                                         │   │
│  │                                                         │   │
│  │ 在 config.json 中配置 API 端点：                        │   │
│  │ ```json                                                 │   │
│  │ {                                                       │   │
│  │   "api": {                                              │   │
│  │     "baseUrl": "http://localhost:3001",                 │   │
│  │     ...                                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 📄 deployment.md                       相似度: 0.85     │   │
│  │ ─────────────────────────────────────────────────────── │   │
│  │ ### 环境变量配置                                        │   │
│  │                                                         │   │
│  │ 设置 API_BASE_URL 环境变量来指定 API 端点...            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                      [关闭]     │
└─────────────────────────────────────────────────────────────────┘
```

### 5.4 数据结构

```typescript
type KnowledgeSourceType = 'local' | 'notion' | 'confluence' | 'github'

interface KnowledgeBase {
  id: string
  name: string
  description?: string
  sourceType: KnowledgeSourceType

  // 本地文件夹
  sourcePaths: string[]
  fileTypes: string[]
  excludePatterns: string[]

  // 索引设置
  chunkSize: number
  chunkOverlap: number

  // 状态
  indexStatus: 'idle' | 'indexing' | 'ready' | 'error'
  indexProgress?: number
  documentCount: number
  vectorCount: number
  lastIndexed?: number
  lastError?: string
}

interface VectorStoreConfig {
  provider: 'local' | 'qdrant' | 'pinecone' | 'chroma'

  // 本地存储
  localPath?: string

  // 云服务
  apiKey?: string
  endpoint?: string
  indexName?: string

  // 嵌入配置
  embeddingProvider: string
  embeddingModel: string
}

interface SearchResult {
  documentId: string
  documentName: string
  content: string
  similarity: number
  metadata: Record<string, unknown>
}
```

---

## 6. 系统设置页面

### 6.1 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  系统设置                                                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ─────────────────── 服务配置 ───────────────────              │
│                                                                 │
│  HTTP 服务端口                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 3001                                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  服务地址                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ localhost                                          [▼]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│  可选: localhost, 0.0.0.0 (允许外部访问)                        │
│                                                                 │
│  ─────────────────── 应用行为 ───────────────────              │
│                                                                 │
│  ☑ 开机自动启动                                                 │
│  ☑ 关闭时最小化到系统托盘                                       │
│  □ 启动时自动检查更新                                           │
│                                                                 │
│  ─────────────────── 日志设置 ───────────────────              │
│                                                                 │
│  日志级别                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ○ Debug   ● Info   ○ Warn   ○ Error                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  日志文件位置: ~/.office-local-bridge/logs/                     │
│  [打开日志目录]  [清理旧日志]                                   │
│                                                                 │
│  ─────────────────── 数据管理 ───────────────────              │
│                                                                 │
│  配置文件位置: ~/.office-local-bridge/                          │
│  [打开配置目录]                                                 │
│                                                                 │
│  [导出配置]  [导入配置]  [重置所有设置]                         │
│                                                                 │
│  ─────────────────── 关于 ───────────────────                  │
│                                                                 │
│  Office Local Bridge v1.0.0                                     │
│  [检查更新]  [查看文档]  [反馈问题]                             │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                              [重置]  [保存]     │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. 仪表盘页面

### 7.1 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  仪表盘                                                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐│
│  │ 服务状态         │ │ AI 提供商        │ │ MCP 服务器       ││
│  │ ━━━━━━━━━━━━━━━ │ │ ━━━━━━━━━━━━━━━ │ │ ━━━━━━━━━━━━━━━ ││
│  │ ● 运行中        │ │ 已配置: 3        │ │ 运行中: 2/3      ││
│  │ 端口: 3001      │ │ 默认: OpenAI     │ │                  ││
│  │ 运行时间: 2h    │ │                  │ │                  ││
│  └──────────────────┘ └──────────────────┘ └──────────────────┘│
│                                                                 │
│  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐│
│  │ 知识库           │ │ 联网搜索         │ │ 今日请求         ││
│  │ ━━━━━━━━━━━━━━━ │ │ ━━━━━━━━━━━━━━━ │ │ ━━━━━━━━━━━━━━━ ││
│  │ 知识库: 2        │ │ ● 已启用         │ │ AI 请求: 156     ││
│  │ 文档数: 198      │ │ 引擎: Tavily     │ │ MCP 调用: 89     ││
│  │ 向量数: 18,020   │ │                  │ │ 搜索: 23         ││
│  └──────────────────┘ └──────────────────┘ └──────────────────┘│
│                                                                 │
│  ─────────────────── 快速操作 ───────────────────              │
│                                                                 │
│  [配置 AI 服务]  [管理 MCP]  [添加知识库]  [查看日志]           │
│                                                                 │
│  ─────────────────── 最近活动 ───────────────────              │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 10:35:22  [AI]   GPT-4o 完成请求 (1.2s)                 │   │
│  │ 10:35:18  [MCP]  Word: insert_text 执行成功             │   │
│  │ 10:34:55  [搜索] "MCP 协议" 返回 5 条结果               │   │
│  │ 10:34:30  [AI]   GPT-4o 完成请求 (0.8s)                 │   │
│  │ 10:33:45  [MCP]  Excel: get_cell_value 执行成功         │   │
│  │ ...                                                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 总结

本文档详细定义了桌面应用各配置页面的：
- UI 布局设计
- 交互逻辑
- 数据结构
- 功能点清单

开发时应按照本文档的设计进行实现，确保用户体验一致性。
